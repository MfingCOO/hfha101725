(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3479],{30018:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eQ});var a=t(95155),l=t(61931),i=t(14294);let r=(0,i.A)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var n=t(28127),c=t(27500),d=t(36419),o=t(45444),h=t(73182),m=t(10409),x=t(20063),u=t(52619),f=t.n(u),p=t(15283),j=t(82224),g=t(89836);let v=[{href:"/client/dashboard",label:"Dashboard",icon:r,isLink:!0},{href:"#",label:"Calendar",icon:n.A,isLink:!1,id:"calendar"},{href:"#",label:"Chats",icon:c.A,isLink:!1,id:"chats"},{href:"#",label:"Challenges",icon:d.A,isLink:!1,id:"challenges"}],N=[{href:"/coach/dashboard",label:"Dashboard",icon:r,isLink:!0}];function b(){let e=(0,x.usePathname)(),{isCoach:s}=(0,j.A)(),{onOpenChallenges:t,onOpenChats:l,onOpenCalendar:i}=(0,g.vg)(),r=s?"/settings":"/client/settings";return(0,a.jsxs)(h.Bx,{children:[(0,a.jsxs)(h.Gh,{children:[(0,a.jsx)(m.g,{className:"text-primary size-8"}),(0,a.jsx)("h1",{className:"text-xl font-semibold tracking-tight",children:"HungerFree"})]}),(0,a.jsx)(h.Yv,{children:(0,a.jsx)(h.wZ,{children:(s?N:v).map(s=>(0,a.jsx)(h.FX,{children:s.isLink?(0,a.jsx)(f(),{href:s.href,children:(0,a.jsxs)(h.Uj,{isActive:e.startsWith(s.href),tooltip:s.label,children:[(0,a.jsx)(s.icon,{}),(0,a.jsx)("span",{children:s.label})]})}):(0,a.jsxs)(h.Uj,{isActive:!1,tooltip:s.label,onClick:()=>{s.isLink||("challenges"===s.id?t():"chats"===s.id?l():"calendar"===s.id&&i())},children:[(0,a.jsx)(s.icon,{}),(0,a.jsx)("span",{children:s.label})]})},s.label))})}),(0,a.jsx)(h.CG,{children:(0,a.jsxs)(h.wZ,{children:[(0,a.jsx)(h.FX,{children:(0,a.jsx)(f(),{href:r,children:(0,a.jsxs)(h.Uj,{isActive:e.startsWith(r),tooltip:"Settings",children:[(0,a.jsx)(o.A,{}),(0,a.jsx)("span",{children:"Settings"})]})})}),(0,a.jsx)("div",{className:"p-2 border-t mt-auto",children:(0,a.jsx)(p.p,{})})]})})]})}var y=t(12115);let w=(0,i.A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var C=t(27314),k=t(64269),S=t(44385);function A(){let e=(0,x.usePathname)(),{user:s,isCoach:t,userProfile:l}=(0,j.A)(),i=(0,S.a)(),r=(0,x.useRouter)(),{onOpenChallenges:o,onOpenChats:h,onOpenCalendar:m,onOpenSettings:u}=(0,g.vg)(),{hasUnreadChats:f}=(0,g.TN)(),p=[{href:"/client/dashboard",label:"Home",icon:w,action:()=>r.push("/client/dashboard")},{href:"#",label:"Calendar",icon:n.A,action:m},{href:"#",label:"Chats",icon:c.A,action:h},{href:"#",label:"Challenges",icon:d.A,action:o},{href:"#",label:"Profile",icon:C.A,action:u}];return i&&s&&!t?(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("footer",{className:"fixed bottom-0 left-0 right-0 z-40 h-16 border-t bg-background/95 backdrop-blur-sm md:hidden",children:(0,a.jsx)("nav",{className:"flex items-center justify-around h-full",children:p.map(s=>{let t="#"!==s.href&&e.startsWith(s.href);return(0,a.jsxs)("button",{onClick:e=>{e.preventDefault(),s.action()},className:(0,k.cn)("flex flex-col items-center justify-center w-full h-full text-muted-foreground transition-colors relative",t?"text-primary":"hover:text-primary/80","/client/dashboard"===s.href&&"/client/dashboard"===e&&"text-primary"),children:["Chats"===s.label&&f&&(0,a.jsx)("div",{className:"absolute top-2 right-1/2 translate-x-[20px] h-2 w-2 rounded-full bg-blue-500"}),(0,a.jsx)(s.icon,{className:"h-6 w-6"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:s.label})]},s.label)})})})}):null}var D=t(30926);let P=(0,D.createServerReference)("400bd0ed8acf07e487f27f7bf0a1ff892043ec5e56",D.callServer,void 0,D.findSourceMapURL,"getNextDueNotificationAction"),M=(0,D.createServerReference)("40444092983ab4fd5da305a1f8e89b567f77e7d63f",D.callServer,void 0,D.findSourceMapURL,"getNextNotificationTimeAction"),O=(0,D.createServerReference)("60cdf376926e3c84a19b8b3261dfb98a7406df97f8",D.callServer,void 0,D.findSourceMapURL,"dismissReminderAction");var E=t(51834),T=t(3998),L=t(61680),R=t(35437),U=t(15894),F=t(89988),G=t(15239),$=t(92033);function z(e){var s,t,l,i,r;let{isOpen:n,onClose:c,reminder:o}=e,{toast:h}=(0,U.dj)(),{user:m}=(0,j.A)(),u=(0,x.useRouter)(),[p,g]=(0,y.useState)(!1),[v,N]=(0,y.useState)(!1);if(!o)return null;let b=R.S.find(e=>e.id===o.pillarId),w=(null==b?void 0:b.icon)||d.A,C="custom-popup"===o.type,k=async()=>{(null==m?void 0:m.uid)&&o.id&&await O(m.uid,o.id),c()},S=async()=>{if(m&&o.requiredTier){N(!0);try{let e=o.requiredTier,{url:s,error:t}=await (0,F.a)(m.uid,e,"monthly");if(s)window.location.href=s;else throw Error(t||"Could not create a checkout session.")}catch(e){h({variant:"destructive",title:"Error",description:e.message}),N(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.lG,{open:n,onOpenChange:c,children:(0,a.jsxs)(E.Cf,{className:"w-[90vw] sm:max-w-md",children:[C&&(null==(s=o.data)?void 0:s.imageUrl)&&(0,a.jsx)("div",{className:"relative w-full h-40",children:(0,a.jsx)(G.default,{src:o.data.imageUrl,alt:o.title,layout:"fill",className:"object-cover rounded-t-lg",unoptimized:!0})}),(0,a.jsxs)(E.c7,{className:"text-center pt-4",children:[!C&&(0,a.jsx)("div",{className:"mx-auto bg-primary/10 rounded-full h-16 w-16 flex items-center justify-center mb-4",children:(0,a.jsx)(w,{className:"h-8 w-8 text-primary"})}),(0,a.jsx)(E.L3,{className:"text-2xl",children:o.title}),(0,a.jsx)(E.rr,{className:"text-base px-4",children:o.message})]}),(0,a.jsxs)(E.Es,{className:"flex-col sm:flex-row gap-2",children:["custom-popup"!==o.type&&(0,a.jsx)(T.$,{onClick:k,variant:"outline",className:"w-full",children:"Dismiss"}),"log"===o.type&&b&&(0,a.jsxs)(T.$,{onClick:()=>{g(!0)},className:"w-full",children:["Log ",b.label]}),"upgrade"===o.type&&o.requiredTier&&(0,a.jsxs)(T.$,{onClick:S,disabled:v,className:"w-full",children:[v&&(0,a.jsx)($.A,{className:"h-4 w-4 animate-spin"}),"Upgrade to ",o.requiredTier]}),"custom-popup"===o.type&&(null==(t=o.data)?void 0:t.ctaUrl)&&(null==(l=o.data)?void 0:l.ctaText)&&(0,a.jsx)(T.$,{asChild:!0,className:"w-full",children:(0,a.jsx)(f(),{href:o.data.ctaUrl,target:"_blank",onClick:k,children:o.data.ctaText})}),"custom-popup"===o.type&&!(null==(i=o.data)?void 0:i.ctaUrl)&&(0,a.jsx)(T.$,{onClick:k,className:"w-full",children:(null==(r=o.data)?void 0:r.ctaText)||"Got it!"})]})]})}),p&&b&&(0,a.jsx)(L.X,{open:p,onOpenChange:e=>{g(!1),e&&(u.refresh(),k())},pillar:b})]})}var I=t(50589),J=t(86948);let q=(0,D.createServerReference)("6092f9d282509bde2b1764238f36cdef599c6bb350",D.callServer,void 0,D.findSourceMapURL,"joinChallenge");var B=t(55428),H=t(37785),W=t(91195),Y=t(11647),Z=t(6943),_=t(33173),V=t(41546);let X=(0,D.createServerReference)("00d0aaa74ee6a39b977815fb842b6143e60e2ee0c5",D.callServer,void 0,D.findSourceMapURL,"getChallengesForClient");var K=t(73457),Q=t(76444),ee=t(17037),es=t(51190),et=t(63263),ea=t(18527),el=t(66065),ei=t(47691),er=t(5282),en=t(8773),ec=t(76273),ed=t(28638);let eo=(0,D.createServerReference)("70ab917ab3ec2611cbfe9f8e437f8c515187942029",D.callServer,void 0,D.findSourceMapURL,"getAllDataForPeriod"),eh=(0,D.createServerReference)("406187d4e8ccae7d364f561d90840750aeb180baea",D.callServer,void 0,D.findSourceMapURL,"logChallengeProgressAction");var em=t(13406),ex=t(11140),eu=t(81962),ef=t(95409),ep=t(45458),ej=t(25583);let eg=e=>{let{challenge:s,userLogs:t,user:l}=e,i=(0,y.useMemo)(()=>{let e=[];return s.scheduledPillars&&e.push(...s.scheduledPillars.map(e=>{var s;return"Log ".concat((null==(s=R.S.find(s=>s.id===e.pillarId))?void 0:s.label)||e.pillarId)})),s.customTasks&&e.push(...s.customTasks.map(e=>e.description)),e},[s]),r=(0,y.useMemo)(()=>{if(!l||!s.progress||!s.progress[l.uid])return i.map(e=>({task:e,currentStreak:0,bestStreak:0}));let e=s.progress[l.uid];return i.map(t=>{let a=0,l=0,i=0,r=(0,ei.o)(new Date),n=(0,ei.o)(new Date(s.dates.from)),c=new Date(r);for(;c>=n;){let s=(0,er.GP)(c,"yyyy-MM-dd");if(e[s]&&e[s][t])l++;else break;c.setDate(c.getDate()-1)}let d=new Date(n);for(;d<=r;){let s=(0,er.GP)(d,"yyyy-MM-dd");e[s]&&e[s][t]?i++:(a=Math.max(a,i),i=0),d.setDate(d.getDate()+1)}return{task:t,currentStreak:l,bestStreak:a=Math.max(a,i)}})},[s,l,i]);return(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsx)(J.Zp,{className:"bg-amber-400/10 border-amber-400/30",children:(0,a.jsxs)(J.Wu,{className:"p-3",children:[(0,a.jsx)("h3",{className:"font-bold text-center text-amber-300 mb-2",children:"Trophy Case"}),(0,a.jsx)("div",{className:"flex justify-center items-center h-20",children:(0,a.jsx)("p",{className:"text-sm text-amber-300/70",children:"Awards and trophies coming soon!"})})]})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"font-bold text-center text-white/80",children:"Your Streaks"}),r.map(e=>{let{task:s,currentStreak:t,bestStreak:l}=e;return(0,a.jsx)(J.Zp,{className:"bg-background/30 border-white/20",children:(0,a.jsxs)(J.Wu,{className:"p-2 flex justify-between items-center text-white",children:[(0,a.jsx)("p",{className:"text-xs font-semibold flex-1 truncate pr-2",children:s}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(ex.A,{className:"w-3.5 h-3.5 text-orange-400"}),(0,a.jsx)("span",{children:t})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(d.A,{className:"w-3.5 h-3.5 text-yellow-400"}),(0,a.jsx)("span",{children:l})]})]})]})},s)})]})]})},ev=y.memo(e=>{var s,t,l;let{currentDay:i,currentDayIndex:r,days:n,challenge:c,isLoading:d,dataLoadError:o,userLogs:h,customHabits:m,getTaskProgressValue:x,isPillarTaskCompleteAutomatically:u,handleProgressChange:f,setCurrentDayIndex:p,hasUnsavedChanges:j,handleSaveProgress:g,isSaving:v}=e;return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"p-4 flex items-center justify-between gap-1 flex-shrink-0 bg-background rounded-t-lg",children:[(0,a.jsx)(T.$,{variant:"ghost",size:"icon",onClick:()=>p(e=>e-1),disabled:0===r,children:(0,a.jsx)(es.A,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"font-bold",children:(0,er.GP)(i,"MM/dd/yy")}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Day ",r+1," of ",n.length]})]}),(0,a.jsx)(T.$,{variant:"ghost",size:"icon",onClick:()=>p(e=>e+1),disabled:r===n.length-1,children:(0,a.jsx)(et.A,{className:"h-6 w-6"})})]}),d?(0,a.jsx)("div",{className:"flex-1 flex justify-center items-center",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin"})}):o?(0,a.jsxs)("div",{className:"flex-1 flex flex-col justify-center items-center text-center p-4",children:[(0,a.jsx)("p",{className:"text-destructive font-semibold",children:"Could not load activity data."}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:o})]}):(0,a.jsx)(ee.F,{className:"flex-1",children:(0,a.jsxs)("div",{className:"p-4 pt-2 space-y-3",children:[null==(s=c.scheduledPillars)?void 0:s.map((e,s)=>{let t=R.S.find(s=>s.id===e.pillarId);if(!t)return null;let l="Log ".concat(t.label),r=u(i,t.id),n=x(l),c=r||!!n;return(0,a.jsxs)("div",{className:"flex items-center space-x-3 p-3 rounded-md bg-muted/50",children:[(0,a.jsx)(K.S,{id:"".concat((0,er.GP)(i,"yyyy-MM-dd"),"-").concat(t.id),checked:c,onCheckedChange:e=>f(l,!!e),disabled:r}),(0,a.jsx)(Q.J,{htmlFor:"".concat((0,er.GP)(i,"yyyy-MM-dd"),"-").concat(t.id),className:(0,k.cn)("text-sm",c&&"line-through text-muted-foreground"),children:l}),r&&(0,a.jsx)(ea.A,{className:"h-4 w-4 text-green-500"})]},"pillar-".concat(s))}),null==(t=c.customTasks)?void 0:t.map((e,s)=>{let t=x(e.description),l="user-records"===e.goalType,i="static"===e.goalType?e.goal:e.startingGoal;if(l)return(0,a.jsxs)("div",{className:"flex flex-col gap-2 p-3 rounded-md bg-muted/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(Q.J,{htmlFor:"".concat(e.description,"-").concat(s),className:"flex-1 text-sm",children:e.description}),(0,a.jsx)(ep.d,{id:"".concat(e.description,"-").concat(s),placeholder:"0",value:t||"",onChange:s=>f(e.description,s),className:"h-8 text-sm w-20",min:0,maxLength:3}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:e.unit})]}),e.notes&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground flex gap-2 items-start",children:[(0,a.jsx)(el.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:e.notes})]})]},"".concat(e.description,"-").concat(s));let r=!!t;return(0,a.jsxs)("div",{className:"p-3 rounded-md bg-muted/50 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(K.S,{id:e.description,checked:r,onCheckedChange:s=>f(e.description,!!s)}),(0,a.jsxs)("div",{className:(0,k.cn)("flex-1 text-sm",r&&"line-through text-muted-foreground"),children:[(0,a.jsx)(Q.J,{htmlFor:e.description,children:e.description}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-1",children:["(",i," ",e.unit,")"]})]})]}),e.notes&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground pt-1 border-t border-white/10 flex gap-2 items-start",children:[(0,a.jsx)(el.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:e.notes})]})]},"".concat(e.description,"-").concat(s))}),null==(l=c.scheduledHabits)?void 0:l.map((e,s)=>{let t=m.find(s=>s.id===e.habitId)||{name:"Habit ".concat(s+1),description:"Complete this habit."},l=!!x(t.name);return(0,a.jsxs)("div",{className:"p-3 rounded-md bg-muted/50 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(K.S,{id:"habit-".concat((0,er.GP)(i,"yyyy-MM-dd"),"-").concat(s),checked:l,onCheckedChange:e=>f(t.name,!!e)}),(0,a.jsx)(Q.J,{htmlFor:"habit-".concat((0,er.GP)(i,"yyyy-MM-dd"),"-").concat(s),className:(0,k.cn)("text-sm",l&&"line-through text-muted-foreground"),children:t.name})]}),e.notes&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground pt-1 border-t border-white/10 flex gap-2 items-start",children:[(0,a.jsx)(el.A,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),(0,a.jsx)("span",{children:e.notes})]})]},"habit-".concat(s))})]})}),j&&(0,a.jsx)("div",{className:"p-4 pt-0",children:(0,a.jsxs)(T.$,{onClick:g,disabled:v,className:"w-full",children:[v&&(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Progress for Day"]})})]})});function eN(e){let{challenge:s,isOpen:t,onClose:l}=e,{toast:i}=(0,U.dj)(),{user:r,userProfile:n}=(0,j.A)(),[c,d]=(0,y.useState)(s),[o,h]=(0,y.useState)(!0),[m,x]=(0,y.useState)(!1),[u,f]=(0,y.useState)([]),[p,g]=(0,y.useState)([]),[v,N]=(0,y.useState)({}),b=Object.keys(v).length>0,[w,C]=(0,y.useState)(null),[k,S]=(0,y.useState)("tasks"),[A,D]=(0,y.useState)(!1),P=(0,y.useCallback)(async()=>{if(r){h(!0),C(null);try{let e=new Date,t=new Date(s.dates.from),a=Math.max(0,(0,W.m)(e,t)+1),[l,i]=await Promise.all([eo(a,r.uid,t),(0,eu.l)()]);if(!l.success)throw Error(l.error||"Could not load your activity logs for this challenge.");f(l.data||[]),i.success&&i.data&&g(i.data)}catch(e){console.error("Error fetching initial challenge data:",e),C(e.message)}finally{h(!1)}}},[r,s.dates.from]);(0,y.useEffect)(()=>{t&&(P(),d(s),S("tasks"))},[t,s,P]);let M=(0,y.useMemo)(()=>{let e=new Date(s.dates.from),t=new Date(s.dates.to);return(0,en.k)({start:e,end:t})},[s.dates.from,s.dates.to]),O=(0,y.useMemo)(()=>M.findIndex(e=>(0,ec.c)(e)),[M]),[E,T]=(0,y.useState)(O>-1?O:0);(0,y.useEffect)(()=>{T(O>-1?O:0)},[O]),(0,y.useEffect)(()=>{N({})},[E]);let L=M[E],R=(0,y.useCallback)((e,s)=>{N(t=>({...t,[e]:s}))},[]),F=(0,y.useCallback)(async()=>{if(!r||!L||!b)return;x(!0);let e=(0,er.GP)((0,ei.o)(L),"yyyy-MM-dd");try{let s=await eh({userId:r.uid,challengeId:c.id,date:e,progress:v});if(s.success)d(s=>{let t={...s.progress};return t[r.uid]||(t[r.uid]={}),t[r.uid][e]||(t[r.uid][e]={}),t[r.uid][e]={...t[r.uid][e],...v},{...s,progress:t}}),N({}),i({title:"Progress Saved!",description:"Your challenge progress for the day has been updated.",...s.insight&&{title:s.insight.title,description:s.insight.message}||{}});else throw Error(s.error||"Failed to save progress.")}catch(e){i({variant:"destructive",title:"Update Failed",description:e.message})}finally{x(!1)}},[r,L,b,c.id,v,i]),$=(0,y.useCallback)(e=>{var s,t,a;let l=(0,er.GP)((0,ei.o)(L),"yyyy-MM-dd");return v.hasOwnProperty(e)?v[e]:null==(a=c.progress)||null==(t=a[r.uid])||null==(s=t[l])?void 0:s[e]},[c.progress,L,v,r.uid]),z=(0,y.useCallback)((e,s)=>{if(!e)return!1;let t=u.filter(s=>s.entryDate&&(0,ed.r)(new Date(s.entryDate),e));return"hydration"===s?t.filter(e=>"hydration"===e.pillar).reduce((e,s)=>e+(s.amount||0),0)>=((null==n?void 0:n.suggestedHydrationGoal)||64):t.some(e=>e.pillar===s)},[u,null==n?void 0:n.suggestedHydrationGoal]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ef.d,{isOpen:t,onClose:l,title:s.name,className:"w-[90vw] max-w-4xl h-[90vh] bg-background shadow-2xl p-0",children:(0,a.jsxs)("div",{className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"p-3 border-b flex items-center gap-3",children:[(0,a.jsx)("div",{className:"relative w-12 h-12 rounded-md overflow-hidden flex-shrink-0",children:(0,a.jsx)(G.default,{src:s.thumbnailUrl||"https://placehold.co/100x100.png",alt:s.name,fill:!0,className:"object-cover",unoptimized:!0})}),(0,a.jsx)("h2",{className:"text-base font-bold tracking-tight text-left flex-1",children:s.name})]}),(0,a.jsxs)(em.tU,{value:k,onValueChange:e=>{"chat"===e?(D(!0),setTimeout(()=>S("tasks"),0)):S(e)},className:"flex-1 flex flex-col min-h-0 overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 min-h-0",children:[(0,a.jsx)(em.av,{value:"tasks",className:"m-0 h-full",children:(0,a.jsx)(ev,{currentDay:L,currentDayIndex:E,days:M,challenge:c,isLoading:o,dataLoadError:w,userLogs:u,customHabits:p,getTaskProgressValue:$,isPillarTaskCompleteAutomatically:z,handleProgressChange:R,setCurrentDayIndex:T,hasUnsavedChanges:b,handleSaveProgress:F,isSaving:m})}),(0,a.jsx)(em.av,{value:"progress",className:"m-0 h-full",children:(0,a.jsx)(eg,{challenge:c,userLogs:u,user:r})})]}),(0,a.jsx)("div",{className:"p-2 border-t",children:(0,a.jsxs)(em.j7,{className:"grid w-full grid-cols-3 mx-auto max-w-sm mt-auto flex-shrink-0",children:[(0,a.jsx)(em.Xi,{value:"tasks",children:"Daily Tasks"}),(0,a.jsx)(em.Xi,{value:"progress",children:"Trophies"}),(0,a.jsx)(em.Xi,{value:"chat",children:"Chat"})]})})]})]})}),A&&(0,a.jsx)(ej.R,{isOpen:A,onClose:()=>D(!1),chatId:c.id,chatName:c.name})]})}ev.displayName="DailyTasks";var eb=t(88566);function ey(){let{user:e,userProfile:s}=(0,j.A)(),{toast:t}=(0,U.dj)(),[l,i]=(0,y.useState)([]),[r,c]=(0,y.useState)(!0),[d,o]=(0,y.useState)(null),[h,m]=(0,y.useState)(!1),[x,u]=(0,y.useState)(null);(0,y.useEffect)(()=>{(async()=>{if(!e)return;c(!0);let s=await X();s.success&&s.data&&i(s.data.map(e=>({...e,dates:{from:new Date(e.dates.from),to:new Date(e.dates.to)}}))),c(!1)})()},[e]);let f=async a=>{if(!e||!s)return;let l=eb.qc.indexOf("premium");if(eb.qc.indexOf(s.tier)<l)return void m(!0);o(a);try{let s=await q(a,e.uid);if(s.success)t({title:"Challenge Joined!",description:"You are now a participant. Good luck!"}),i(s=>s.map(s=>s.id===a?{...s,participants:[...s.participants||[],e.uid],participantCount:(s.participantCount||0)+1}:s));else{var r;throw Error((null==(r=s.error)?void 0:r.toString())||"Could not join challenge.")}}catch(e){console.error("Error joining challenge:",e),t({variant:"destructive",title:"Error",description:"There was a problem joining the challenge. Please try again."})}finally{o(null)}},p=l.filter(s=>e&&(s.participants||[]).includes(e.uid)),g=l.filter(s=>!e||!(s.participants||[]).includes(e.uid));return r?(0,a.jsx)("div",{className:"flex items-center justify-center p-24",children:(0,a.jsx)($.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col items-center space-y-8",children:[p.length>0&&(0,a.jsxs)("div",{className:"w-full max-w-sm space-y-3",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight text-center",children:"My Challenges"}),p.map(e=>(0,a.jsx)(J.Zp,{className:"overflow-hidden cursor-pointer hover:border-primary/50",onClick:()=>u(e),children:(0,a.jsxs)(J.Wu,{className:"p-2 flex flex-row gap-3 items-center",children:[(0,a.jsxs)("div",{className:"relative h-16 w-16 flex-shrink-0 rounded-md overflow-hidden",children:[(0,a.jsx)(G.default,{src:e.thumbnailUrl||"https://placehold.co/400x400.png",alt:e.name,fill:!0,className:"object-cover",unoptimized:!0}),(0,B.R)(e.dates.to)&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:(0,a.jsx)(Y.E,{variant:"secondary",children:"Ended"})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col justify-between self-stretch",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-sm leading-tight",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-1",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-0.5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Z.A,{className:"w-3 h-3"})," ",(0,a.jsxs)("span",{children:[e.participantCount,"/",e.maxParticipants]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.A,{className:"w-3 h-3"})," ",(0,a.jsxs)("span",{children:["Ends in ",(0,H.B)(e.dates.to,new Date,{addSuffix:!0})]})]})]})]}),(0,a.jsxs)(T.$,{size:"sm",className:"w-full h-7 mt-1 text-xs",onClick:()=>u(e),children:["View Progress ",(0,a.jsx)(_.A,{className:"ml-1 h-3 w-3"})]})]})]})},e.id))]}),(0,a.jsxs)("div",{className:"w-full max-w-sm space-y-3",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight text-center",children:"Available Challenges"}),g.length>0?g.map(s=>{let t=!!e&&(s.participants||[]).includes(e.uid),l=s.participantCount>=s.maxParticipants,i=(0,B.R)(s.dates.to),r="Join Challenge";return l&&!t&&(r="Full"),i&&!t&&(r="Ended"),(0,a.jsx)(J.Zp,{className:"overflow-hidden",children:(0,a.jsxs)(J.Wu,{className:"p-2 flex flex-row gap-3 items-center",children:[(0,a.jsx)("div",{className:"relative h-16 w-16 flex-shrink-0 rounded-md overflow-hidden",children:(0,a.jsx)(G.default,{src:s.thumbnailUrl||"https://placehold.co/400x400.png",alt:s.name,fill:!0,className:"object-cover",unoptimized:!0})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col justify-between self-stretch",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-sm leading-tight",children:s.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-1",children:s.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mt-0.5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Z.A,{className:"w-3 h-3"})," ",(0,a.jsxs)("span",{children:[s.participantCount,"/",s.maxParticipants]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(n.A,{className:"w-3 h-3"})," ",(0,a.jsxs)("span",{children:[(0,W.m)(s.dates.to,s.dates.from)," days"]})]})]})]}),(0,a.jsxs)(T.$,{size:"sm",className:"w-full h-7 mt-1 text-xs",disabled:d===s.id||l&&!t||i&&!t,onClick:()=>f(s.id),children:[d===s.id&&(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),r]})]})]})},s.id)}):(0,a.jsxs)(J.Zp,{children:[(0,a.jsxs)(J.aR,{children:[(0,a.jsx)(J.ZB,{children:"No New Challenges"}),(0,a.jsx)(J.BT,{children:"There are no new challenges available to join right now."})]}),(0,a.jsx)(J.Wu,{children:(0,a.jsxs)("div",{className:"text-center text-muted-foreground p-12",children:[(0,a.jsx)("p",{className:"font-semibold text-lg",children:"Stay Tuned!"}),(0,a.jsx)("p",{className:"text-sm",children:"Our coaches are busy crafting the next magnificent challenge."})]})})]})]})]}),x&&(0,a.jsx)(eN,{challenge:x,isOpen:!!x,onClose:()=>u(null)}),(0,a.jsx)(V.k,{isOpen:h,onClose:()=>m(!1),requiredTier:"premium",featureName:"Community Challenges",reason:"Community builds pillar synergy for motivation!"})]})}function ew(e){let{isOpen:s,onClose:t}=e;return(0,a.jsx)(ef.d,{isOpen:s,onClose:t,title:"Community Challenges",description:"Join group challenges, track your progress, and stay motivated.",children:(0,a.jsx)(ey,{})})}var eC=t(28263),ek=t(98428),eS=t(7710),eA=t(98173);let eD=(0,D.createServerReference)("60e5858f694c4f63577fed45883df63bcfbc7af87c",D.callServer,void 0,D.findSourceMapURL,"joinChat"),eP=(0,D.createServerReference)("60f35a00f477bdeb4265c89926c3f0ef97d8fff221",D.callServer,void 0,D.findSourceMapURL,"leaveChatAction");var eM=t(98053),eO=t(6259),eE=t(59338);let eT=(0,D.createServerReference)("605613f7ddb9ac48ccfeab1142aa81a281956a3cf4",D.callServer,void 0,D.findSourceMapURL,"getCoachAvailabilityAndEvents");var eL=t(55879),eR=t(39089),eU=t(32078),eF=t(21356),eG=t(43371);function e$(e,s,t){let[a,l]=[+(0,eG.a)(e.start),+(0,eG.a)(e.end)].sort((e,s)=>e-s),[i,r]=[+(0,eG.a)(s.start),+(0,eG.a)(s.end)].sort((e,s)=>e-s);return(null==t?void 0:t.inclusive)?a<=r&&i<=l:a<r&&i<l}var ez=t(33086),eI=t(52226),eJ=t(63146),eq=t(54618);let eB=[{name:"Alan Roberts",id:eq.h[0]},{name:"Crystal Roberts",id:eq.h[1]}];function eH(e){let{isOpen:s,onClose:t}=e,{toast:l}=(0,U.dj)(),{user:i,userProfile:r}=(0,j.A)(),[n,c]=(0,y.useState)((0,eR.k)((0,eU.f)(new Date,2))),[d,o]=(0,y.useState)((0,eU.f)(new Date,2)),[h,m]=(0,y.useState)(eB[0].id),[x,u]=(0,y.useState)(null),[f,p]=(0,y.useState)([]),[g,v]=(0,y.useState)(!0),[N,b]=(0,y.useState)(null),[w,k]=(0,y.useState)(!1);(0,y.useEffect)(()=>{if(s&&d){v(!0),b(null);let e=(0,ei.o)(d),s=(0,eF.z)(e,1439);eT(e,s).then(e=>{e.success&&e.data?(u(e.data.availability),p(e.data.events)):l({variant:"destructive",title:"Error",description:"Could not fetch coach availability."}),v(!1)})}},[s,d,l]);let S=e=>{c(s=>(0,eU.f)(s,"next"===e?7:-7))},A=(0,y.useMemo)(()=>{var e;if(!x||!d||(null==(e=x.vacationBlocks)?void 0:e.some(e=>e$({start:(0,ei.o)(d),end:(0,ez.D)(d)},{start:new Date(e.start),end:new Date(e.end)}))))return[];let s=(0,eI.P)(d),t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=x.weekly.find(e=>e.day===t[s]);if(!a||!a.enabled)return[];let l=[];for(let e of a.slots){let[s,t]=e.start.split(":").map(Number),[a,i]=e.end.split(":").map(Number),r=new Date(d);r.setHours(s,t,0,0);let n=new Date(d);for(n.setHours(a,i,0,0);r<n;){let e=(0,eF.z)(r,15);f.some(s=>e$({start:r,end:e},{start:new Date(s.start),end:new Date(s.end)},{inclusive:!1}))||l.push(new Date(r)),r=(0,eF.z)(r,15)}}return l},[x,d,f]),D=async()=>{if(N&&i&&r&&h){k(!0);try{let e=eB.find(e=>e.id===h),s={title:"Coaching: ".concat(r.fullName),start:N,end:(0,eF.z)(N,15),clientId:i.uid,clientName:r.fullName,coachId:null==e?void 0:e.id,coachName:null==e?void 0:e.name,isPersonal:!1,attachVideoLink:!0},a=await (0,eL.K)(s);if(a.success)l({title:"Appointment Booked!",description:"Your call is confirmed for ".concat((0,er.GP)(N,"PPP p"),".")}),t();else throw Error(a.error||"Failed to book appointment.")}catch(e){l({variant:"destructive",title:"Booking Failed",description:e.message})}finally{k(!1)}}},P=(0,y.useMemo)(()=>(0,en.k)({start:(0,eU.f)(new Date,2),end:(0,eU.f)(new Date,30)}),[]),M=(0,y.useMemo)(()=>(0,en.k)({start:n,end:(0,eJ.$)(n)}),[n]);return(0,a.jsx)(E.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(E.Cf,{className:"w-[90vw] max-w-md p-0 h-[90vh] flex flex-col",children:[(0,a.jsxs)(E.c7,{className:"p-4 border-b",children:[(0,a.jsx)(E.L3,{children:"Book a Coaching Call"}),(0,a.jsx)(E.rr,{children:"Select a coach, date, and time for your 15-minute check-in."})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0 p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(Q.J,{children:"Select Coach"}),(0,a.jsx)("div",{className:"flex gap-2",children:eB.map(e=>(0,a.jsxs)(T.$,{variant:h===e.id?"default":"outline",onClick:()=>m(e.id),className:"flex-1",children:[(0,a.jsx)(C.A,{className:"mr-2 h-4 w-4"})," ",e.name.split(" ")[0]]},e.id))})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(Q.J,{children:"Select Date"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(T.$,{variant:"outline",size:"icon",className:"h-10 w-10",onClick:()=>S("prev"),disabled:(0,ed.r)(n,(0,eR.k)((0,eU.f)(new Date,2))),children:(0,a.jsx)(es.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"flex-1 grid grid-cols-7 gap-1",children:M.map(e=>{let s=P.some(s=>(0,ed.r)(s,e));return(0,a.jsxs)(T.$,{variant:"date",size:"sm",disabled:!s,"data-selected":!!d&&(0,ed.r)(e,d),onClick:()=>o(e),className:"h-12 text-xs",children:[(0,a.jsx)("span",{className:"text-xs uppercase",children:(0,er.GP)(e,"EEE")}),(0,a.jsx)("span",{className:"text-base font-bold",children:(0,er.GP)(e,"d")})]},e.toISOString())})}),(0,a.jsx)(T.$,{variant:"outline",size:"icon",className:"h-10 w-10",onClick:()=>S("next"),disabled:(0,ed.r)(n,(0,eR.k)((0,eU.f)(new Date,30))),children:(0,a.jsx)(et.A,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 space-y-2 flex flex-col min-h-0",children:[(0,a.jsxs)(Q.J,{children:["Available Times for ",d?(0,er.GP)(d,"PPP"):"..."]}),(0,a.jsx)("div",{className:"flex-1 rounded-lg border min-h-0",children:g?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin"})}):A.length>0?(0,a.jsx)(ee.F,{className:"h-full",children:(0,a.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2 p-2",children:A.map(e=>(0,a.jsx)(T.$,{variant:(null==N?void 0:N.getTime())===e.getTime()?"default":"outline",onClick:()=>b(e),size:"sm",children:(0,er.GP)(e,"p")},e.toISOString()))})}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-center p-4",children:(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No available slots for this day. Please try another date."})})})]})]}),(0,a.jsxs)(E.Es,{className:"p-4 border-t",children:[(0,a.jsx)(T.$,{variant:"outline",onClick:t,children:"Cancel"}),(0,a.jsxs)(T.$,{onClick:D,disabled:!N||w,children:[w?(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,a.jsx)(eE.A,{className:"mr-2 h-4 w-4"}),"Confirm Booking"]})]})]})})}function eW(){let{user:e,userProfile:s,loading:t}=(0,j.A)(),{chats:l,fetchChats:i}=(0,g.TN)(),{toast:r}=(0,U.dj)(),[n,c]=(0,y.useState)(!1),[d,o]=(0,y.useState)([]),[h,m]=(0,y.useState)(null),[x,u]=(0,y.useState)(null),[f,p]=(0,y.useState)(null),[v,N]=(0,y.useState)({isOpen:!1,chat:null}),[b,w]=(0,y.useState)({isOpen:!1,chat:null}),[C,k]=(0,y.useState)(!1),[S,A]=(0,y.useState)(!1),[D,P]=(0,y.useState)(!1),M=l||[];(0,y.useEffect)(()=>{e&&(0,eA.m)().then(e=>{e.success&&e.data&&o(e.data)})},[e]);let{myChats:O,availableChats:E}=(0,y.useMemo)(()=>({myChats:M.filter(s=>s.participants.includes((null==e?void 0:e.uid)||"")),availableChats:M.filter(s=>!s.participants.includes((null==e?void 0:e.uid)||"")&&"open"===s.type)}),[M,e]),L=async()=>{if(!v.chat||!e)return;k(!0);let s=await eD(v.chat.id,e.uid);s.success?(r({title:"Welcome!",description:'You have successfully joined the "'.concat(v.chat.name,'" chat.')}),i()):r({variant:"destructive",title:"Error",description:s.error||"Could not join chat."}),k(!1),N({isOpen:!1,chat:null})},R=async()=>{if(!b.chat||!e)return;A(!0);let s=await eP(b.chat.id,e.uid);s.success?(r({title:"Chat Left",description:'You have left "'.concat(b.chat.name,'".')}),i()):r({variant:"destructive",title:"Error",description:s.error||"Could not leave chat."}),A(!1),w({isOpen:!1,chat:null})};if(t)return(0,a.jsx)("div",{className:"flex h-full items-center justify-center p-24",children:(0,a.jsx)($.A,{className:"h-12 w-12 animate-spin text-primary"})});let F=e=>{let{chat:s,isUnread:t}=e;return(0,a.jsxs)("div",{onClick:()=>m({id:s.id,name:s.name}),className:"w-full text-left p-3 rounded-lg border bg-card hover:bg-muted transition-colors flex items-center gap-2 cursor-pointer",children:[t&&(0,a.jsx)("div",{className:"h-2.5 w-2.5 rounded-full bg-blue-500 flex-shrink-0"}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-semibold",children:s.name}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(T.$,{variant:"secondary",size:"sm",className:"h-8",onClick:e=>{e.stopPropagation(),m({id:s.id,name:s.name})},children:n?(0,a.jsx)($.A,{className:"h-4 w-4 animate-spin"}):"Open"}),"coaching"!==s.type&&(0,a.jsxs)(eO.rI,{children:[(0,a.jsx)(eO.ty,{asChild:!0,children:(0,a.jsx)(T.$,{variant:"ghost",size:"icon",className:"h-8 w-8 ml-1",children:(0,a.jsx)(eC.A,{className:"h-4 w-4"})})}),(0,a.jsx)(eO.SQ,{align:"end",children:(0,a.jsxs)(eO._2,{className:"text-destructive",onClick:e=>{e.stopPropagation(),w({isOpen:!0,chat:s})},children:[(0,a.jsx)(ek.A,{className:"mr-2 h-4 w-4"})," Leave Chat"]})})]})]})]})};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"My Chats"}),(null==s?void 0:s.tier)==="coaching"&&(0,a.jsxs)(T.$,{onClick:()=>P(!0),size:"sm",variant:"outline",children:[(0,a.jsx)(eS.A,{className:"mr-2 h-4 w-4"}),"Book a Call"]})]}),O.length>0?(0,a.jsx)("div",{className:"space-y-3",children:O.map(s=>{let t=s.lastMessageSenderId!==(null==e?void 0:e.uid);return(0,a.jsx)(F,{chat:s,isUnread:t},s.id)})}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your conversations will appear here once you join a chat or get coaching."}),E.length>0&&(0,a.jsxs)("div",{className:"space-y-4 pt-8",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold tracking-tight",children:"Discover Open Chats"}),(0,a.jsx)("div",{className:"space-y-3",children:E.map(e=>(0,a.jsxs)("div",{className:"w-full text-left p-3 rounded-lg border bg-card hover:bg-muted transition-colors flex flex-col items-start gap-2 disabled:opacity-50",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 w-full",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("p",{className:"font-semibold",children:e.name}),"challenge"===e.type&&(0,a.jsx)(Y.E,{variant:"secondary",children:"Challenge"})]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-2",children:e.description})]}),(0,a.jsx)("div",{className:"w-full pt-2 border-t border-white/10",children:(0,a.jsx)(T.$,{onClick:()=>(e=>{let t="premium";(s?eb.qc.indexOf(s.tier):0)<eb.qc.indexOf(t)?p({isOpen:!0,requiredTier:t}):N({isOpen:!0,chat:e})})(e),size:"sm",className:"w-full",children:"Join Chat"})})]},e.id))})]})]}),h&&(0,a.jsx)(ej.R,{isOpen:!!h,onClose:()=>{m(null),i()},chatId:h.id,chatName:h.name}),f&&(0,a.jsx)(V.k,{isOpen:f.isOpen,onClose:()=>p(null),requiredTier:f.requiredTier,featureName:"Community Chats",reason:"Connect with the community and get extra motivation!"}),v.chat&&(0,a.jsx)(eM.Lt,{open:v.isOpen,onOpenChange:()=>N({isOpen:!1,chat:null}),children:(0,a.jsxs)(eM.EO,{children:[(0,a.jsxs)(eM.wd,{children:[(0,a.jsxs)(eM.r7,{children:['Join "',v.chat.name,'"']}),(0,a.jsx)(eM.$v,{children:"Please review the chat rules before joining:"}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground pt-2 text-left max-h-40 overflow-y-auto",children:(0,a.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:(v.chat.rules||["Be respectful and supportive."]).map((e,s)=>(0,a.jsx)("li",{children:e},s))})})]}),(0,a.jsxs)(eM.ck,{children:[(0,a.jsx)(eM.Zr,{children:"Cancel"}),(0,a.jsxs)(eM.Rx,{onClick:L,disabled:C,children:[C&&(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Agree & Join"]})]})]})}),b.chat&&(0,a.jsx)(eM.Lt,{open:b.isOpen,onOpenChange:()=>w({isOpen:!1,chat:null}),children:(0,a.jsxs)(eM.EO,{children:[(0,a.jsxs)(eM.wd,{children:[(0,a.jsxs)(eM.r7,{children:['Leave "',b.chat.name,'"?']}),(0,a.jsx)(eM.$v,{children:"You will be removed from this chat and will no longer receive messages. Are you sure?"})]}),(0,a.jsxs)(eM.ck,{children:[(0,a.jsx)(eM.Zr,{children:"Cancel"}),(0,a.jsxs)(eM.Rx,{onClick:R,disabled:S,className:"bg-destructive hover:bg-destructive/90",children:[S&&(0,a.jsx)($.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Leave Chat"]})]})]})}),(0,a.jsx)(eH,{isOpen:D,onClose:()=>P(!1)})]})}function eY(e){let{isOpen:s,onClose:t}=e;return(0,a.jsx)(ef.d,{isOpen:s,onClose:t,title:"My Chats",description:"All your coaching and challenge conversations.",children:(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsx)(eW,{})})})}var eZ=t(5557),e_=t(72578),eV=t(7298);class eX extends y.Component{static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,s){console.error("Caught by local error boundary:",e,s),this.props.toast({variant:"default",title:"So Sorry!",description:"It looks like we hit a small snag. Your last action might not have been saved, but you're safely back on the dashboard.",duration:2e3}),this.props.router.push("/client/dashboard"),setTimeout(()=>this.setState({hasError:!1}),50)}render(){return this.state.hasError?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Redirecting to dashboard..."})]}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}function eK(){let{userProfile:e}=(0,j.A)(),{isChallengesOpen:s,onCloseChallenges:t,isChatsOpen:l,onCloseChats:i,isCalendarOpen:r,onCloseCalendar:n,isSettingsOpen:c,onCloseSettings:d}=(0,g.vg)();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ew,{isOpen:s,onClose:t}),(0,a.jsx)(eY,{isOpen:l,onClose:i}),e&&(0,a.jsx)(eZ.D,{isOpen:r,onClose:n,client:e}),(0,a.jsx)(e_.g,{open:c,onOpenChange:d})]})}function eQ(e){let{children:s}=e,{user:t,loading:i,isCoach:r,userProfile:n}=(0,j.A)(),c=(0,x.useRouter)(),{toast:d}=(0,U.dj)(),[o,m]=(0,y.useState)(null),[u,f]=(0,y.useState)(!1),[p,v]=(0,y.useState)(null);(0,y.useEffect)(()=>{!i&&t&&r&&c.replace("/coach/dashboard")},[t,i,r,c]);let N=(0,y.useCallback)(async()=>{var e;if(!t||(null==n||null==(e=n.trackingSettings)?void 0:e.reminders)===!1)return;p&&clearTimeout(p);let s=await P(t.uid);if(s.success&&s.reminder){m(s.reminder),f(!0);return}let a=await M(t.uid);if(a.success&&a.nextNotificationTime){let e=new Date(a.nextNotificationTime),s=new Date,t=(0,eV.b)(e,s);t>0&&v(setTimeout(()=>{N()},t))}},[t,n,p]);(0,y.useEffect)(()=>(!i&&t&&!r&&n&&N(),()=>{p&&clearTimeout(p)}),[t,i,r,n,N]);let w=async()=>{t&&o&&await O(t.uid,o.id),f(!1),m(null),N()};return i||!t||r?(0,a.jsx)("div",{className:"w-full h-screen flex items-center justify-center",children:(0,a.jsx)($.A,{className:"h-8 w-8 animate-spin"})}):(0,a.jsx)(g.qT,{children:(0,a.jsxs)(h.GB,{children:[(0,a.jsx)(b,{}),(0,a.jsxs)(h.sF,{className:"h-dvh flex flex-col md:ml-64",children:[(0,a.jsx)(l.j,{}),(0,a.jsx)("main",{className:"flex-1 overflow-y-auto",children:(0,a.jsxs)(eX,{router:c,toast:d,children:[(0,a.jsx)("div",{className:"p-4 sm:p-6 lg:p-8 pb-24",children:s}),(null==n?void 0:n.tier)==="free"&&(0,a.jsx)("div",{className:"sticky bottom-16 w-full p-2 bg-background/80 backdrop-blur-sm",children:(0,a.jsx)(I.V,{slotId:"28863765324"})})]})}),(0,a.jsx)(A,{})]}),o&&(0,a.jsx)(z,{isOpen:u,onClose:w,reminder:o}),(0,a.jsx)(eK,{})]})})}},50589:(e,s,t)=>{"use strict";t.d(s,{V:()=>i});var a=t(95155),l=t(12115);function i(e){let{slotId:s}=e,t=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(t.current&&"filled"!==t.current.getAttribute("data-ad-status"))try{(window.adsbygoogle=window.adsbygoogle||[]).push({})}catch(e){console.error(e)}},[s]),(0,a.jsx)("div",{className:"text-center my-4 h-16 flex items-center justify-center",children:(0,a.jsx)("ins",{ref:t,className:"adsbygoogle",style:{display:"block"},"data-ad-client":"pub-6658282343757105","data-ad-slot":s,"data-ad-format":"auto","data-full-width-responsive":"true"})})}},98050:(e,s,t)=>{Promise.resolve().then(t.bind(t,30018))}},e=>{e.O(0,[2992,7138,781,5612,5352,9118,8038,4972,6238,537,7075,6743,6201,3659,7071,7473,7961,9984,1931,8441,1255,7358],()=>e(e.s=98050)),_N_E=e.O()}]);