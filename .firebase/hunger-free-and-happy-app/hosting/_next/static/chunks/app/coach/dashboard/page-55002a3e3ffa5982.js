(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5896],{24128:(e,s,a)=>{"use strict";a.d(s,{h:()=>t});var l=a(30926);let t=(0,l.createServerReference)("60b6220a6d18ecff3dec0d0dcce342766e70717942",l.callServer,void 0,l.findSourceMapURL,"deleteDocumentAction")},55073:(e,s,a)=>{"use strict";a.d(s,{s:()=>t});var l=a(30926);let t=(0,l.createServerReference)("003cfa04c1e0760f50917c16014e9a25cf42ac9c8e",l.callServer,void 0,l.findSourceMapURL,"getLibraryDocumentsAction")},61774:(e,s,a)=>{"use strict";a.d(s,{P:()=>t});var l=a(30926);let t=(0,l.createServerReference)("7e1ccefe58394283c8680c6c0d39c9b4267b6eccfb",l.callServer,void 0,l.findSourceMapURL,"uploadDocumentAction")},64671:(e,s,a)=>{Promise.resolve().then(a.bind(a,77740))},77740:(e,s,a)=>{"use strict";a.d(s,{CoachDashboardClient:()=>ak});var l=a(95155),t=a(86948),n=a(3998),r=a(12115),i=a(88566),c=a(27500),d=a(36419),o=a(43633),h=a(92340),u=a(28127),x=a(18844),m=a(22452),j=a(92033),p=a(72251),f=a(15894),v=a(30926);let g=(0,v.createServerReference)("40ab368696902a0065c3a19c053e755922dedc60e5",v.callServer,void 0,v.findSourceMapURL,"getClientsForCoach");var N=a(85897),y=a(11647),b=a(51834),w=a(13630),C=a(12784),S=a(11140),A=a(69693),k=a(74206),M=a(89031),I=a(12360),R=a(15039),D=a(86259),z=a(48109);let T=e=>{let{icon:s,value:a,unit:t}=e;return(0,l.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,l.jsx)(s,{className:"h-4 w-4 text-muted-foreground"}),(0,l.jsx)("span",{className:"text-xs font-bold",children:a}),(0,l.jsx)("span",{className:"text-[10px] text-muted-foreground -mt-1",children:t})]})},P=e=>{let{title:s,value:a}=e;return(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("p",{className:"text-[10px] text-muted-foreground uppercase tracking-wider",children:s}),(0,l.jsx)("p",{className:"font-bold text-sm",children:a})]})};function E(e){var s;let{client:a,onDeleteClient:r,onRefresh:i,isRefreshing:c}=e,d=a.dailySummary,o=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=Number(e);return null==e||isNaN(a)?"N/A":a.toFixed(s)},h=a.createdAt?(0,z.c)(new Date,new Date(a.createdAt)):0;return(0,l.jsx)(t.Zp,{className:"border-none shadow-none bg-transparent",children:(0,l.jsxs)(t.Wu,{className:"p-0 space-y-3",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center sm:justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("h3",{className:"text-lg font-bold truncate",children:a.fullName}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:a.email})]}),(0,l.jsxs)("div",{className:"flex-shrink-0 flex gap-2",children:[(0,l.jsxs)(n.$,{onClick:i,disabled:c,size:"sm",children:[c&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Refresh"]}),(0,l.jsx)(n.$,{onClick:r,variant:"destructive",size:"sm",children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]})]}),(0,l.jsx)(D.w,{}),(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-1",children:[(0,l.jsx)(P,{title:"Weight",value:"".concat(o(null==d?void 0:d.currentWeight,1)," ").concat((null==d?void 0:d.unit)||"")}),(0,l.jsx)(P,{title:"WtHR",value:o(null==d?void 0:d.currentWthr,2)}),(0,l.jsx)(P,{title:"Age",value:null!=(s=null==d?void 0:d.age)?s:"N/A"}),(0,l.jsx)(P,{title:"Sex",value:(null==d?void 0:d.sex)?d.sex.charAt(0).toUpperCase():"N/A"}),(0,l.jsx)(P,{title:"Duration",value:"".concat(h,"d")})]}),(0,l.jsx)(D.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground mb-2 text-center",children:"7-DAY AVERAGES"}),(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-2",children:[(0,l.jsx)(T,{icon:C.A,value:o(null==d?void 0:d.avgSleep,1),unit:"hr"}),(0,l.jsx)(T,{icon:S.A,value:o(null==d?void 0:d.avgActivity),unit:"min"}),(0,l.jsx)(T,{icon:A.A,value:o(null==d?void 0:d.avgHydration),unit:"oz"}),(0,l.jsx)(T,{icon:k.A,value:o(null==d?void 0:d.avgUpf),unit:"%"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-xs font-semibold text-muted-foreground mb-2 text-center",children:"7-DAY TOTALS"}),(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-2",children:[(0,l.jsx)(T,{icon:M.A,value:o(null==d?void 0:d.cravings),unit:"Cravings"}),(0,l.jsx)(T,{icon:I.A,value:o(null==d?void 0:d.binges),unit:"Binges"}),(0,l.jsx)(T,{icon:R.A,value:o(null==d?void 0:d.stressEvents),unit:"Stress"})]})]})]})})}var B=a(17037),F=a(53875);let U=(0,v.createServerReference)("4010256889a356556413ed662479be85f11be4f6d9",v.callServer,void 0,v.findSourceMapURL,"getCoachingChatIdForClient"),L=(0,v.createServerReference)("40bfca34d0653f8b3a8afcb1764d188a1d1fcb9798",v.callServer,void 0,v.findSourceMapURL,"deleteClientAction"),V=(0,v.createServerReference)("40e59bffcca04205ffa78a9820b413c474e6cfa7ff",v.callServer,void 0,v.findSourceMapURL,"calculateDailySummaries"),$=(0,v.createServerReference)("7f62e8bb557d623d672c17c3e427f0b8ec79ca258a",v.callServer,void 0,v.findSourceMapURL,"generateInsightFlow");var J=a(98053),O=a(59338),Y=a(18527),G=a(66710),H=a(84336),_=a(74640),q=a(5557);function W(e){let{client:s}=e,[a,t]=(0,r.useState)(!1);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.$,{onClick:()=>t(!0),variant:"outline",className:"w-full",children:[(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"View Calendar"]}),a&&(0,l.jsx)(q.D,{isOpen:a,onClose:()=>t(!1),client:s})]})}var X=a(31120),Z=a(94979),K=a(82224);let Q=(0,v.createServerReference)("4052ebc9b0f7ff41ce2f0038f3d321c5666e4c6341",v.callServer,void 0,v.findSourceMapURL,"getCoachNotesAction"),ee=(0,v.createServerReference)("78c68ae0c4e5226c5c33b83f374655bcdd501315c0",v.callServer,void 0,v.findSourceMapURL,"addCoachNoteAction");var es=a(26827);function ea(e){let{client:s}=e,{user:a}=(0,K.A)(),{toast:i}=(0,f.dj)(),[c,d]=(0,r.useState)([]),[o,h]=(0,r.useState)(!0),[u,x]=(0,r.useState)(!1),m=(0,r.useRef)(null),p=(0,r.useCallback)(async()=>{h(!0);let e=await Q(s.uid);e.success&&e.data?d(e.data):i({variant:"destructive",title:"Error",description:"Could not fetch coach notes."}),h(!1)},[s.uid,i]);(0,r.useEffect)(()=>{p()},[p]);let v=async e=>{var l;if(e.preventDefault(),!(null==(l=m.current)?void 0:l.value.trim())||!a||!a.displayName)return;x(!0);let t=m.current.value;try{let e=await ee(s.uid,t,a.uid,a.displayName);if(e.success)i({title:"Note Saved"}),m.current&&(m.current.value=""),p();else throw Error(e.error||"Failed to save note.")}catch(e){i({variant:"destructive",title:"Error",description:e.message})}finally{x(!1)}};return(0,l.jsxs)(t.Zp,{children:[(0,l.jsxs)(t.aR,{children:[(0,l.jsx)(t.ZB,{children:"Coach's Private Notes"}),(0,l.jsx)(t.BT,{children:"Leave private notes for yourself and other coaches regarding this client."})]}),(0,l.jsx)(t.Wu,{children:(0,l.jsx)(B.F,{className:"h-48 w-full rounded-md border p-4",children:o?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(j.A,{className:"h-6 w-6 animate-spin text-primary"})}):c.length>0?(0,l.jsx)("div",{className:"space-y-4",children:c.map(e=>(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsxs)(N.eu,{className:"h-8 w-8 border",children:[(0,l.jsx)(N.BK,{src:"https://placehold.co/100x100.png",alt:e.coachName,"data-ai-hint":"person avatar"}),(0,l.jsx)(N.q5,{children:e.coachName.charAt(0)})]}),(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"font-semibold text-sm",children:e.coachName}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,es.m)(new Date(e.createdAt),{addSuffix:!0})})]}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:e.note})]})]},e.id))}):(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"No notes for this client yet."})})})}),(0,l.jsx)(t.wL,{children:(0,l.jsxs)("form",{onSubmit:v,className:"flex w-full items-start space-x-2",children:[(0,l.jsx)(X.T,{ref:m,placeholder:"Type your note here...",rows:2,disabled:u}),(0,l.jsx)(n.$,{type:"submit",size:"icon",disabled:u,children:u?(0,l.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(Z.A,{className:"h-4 w-4"})})]})})]})}var el=a(11186),et=a(13496),en=a(25583);let er=e=>{let{client:s}=e,{toast:a}=(0,f.dj)(),[t,i]=(0,r.useState)(7),[c,d]=(0,r.useState)(!1),[o,h]=(0,r.useState)(null),u=async()=>{d(!0),h(null);try{let e=await $({clientId:s.uid,days:t});if(e&&e.recommendation)h(e);else throw Error("The AI model did not return a valid insight.")}catch(e){a({variant:"destructive",title:"Insight Failed",description:e.message})}finally{d(!1)}};return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,l.jsxs)(el.l6,{onValueChange:e=>i(parseInt(e)),defaultValue:String(t),children:[(0,l.jsx)(el.bq,{className:"w-full sm:w-[180px]",children:(0,l.jsx)(el.yv,{placeholder:"Select period"})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"3",children:"Last 3 Days"}),(0,l.jsx)(el.eb,{value:"7",children:"Last 7 Days"}),(0,l.jsx)(el.eb,{value:"14",children:"Last 14 Days"}),(0,l.jsx)(el.eb,{value:"30",children:"Last 30 Days"})]})]}),(0,l.jsxs)(n.$,{onClick:u,disabled:c,className:"w-full sm:w-auto",children:[c&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Generate"]})]}),c&&(0,l.jsx)("div",{className:"flex items-center justify-center p-8 rounded-lg bg-muted",children:(0,l.jsx)(j.A,{className:"h-8 w-8 animate-spin text-primary"})}),o&&(0,l.jsxs)("div",{className:"rounded-lg bg-background/80 p-4 space-y-3 animate-in fade-in-50",children:[(0,l.jsxs)("h3",{className:"text-lg font-bold text-primary flex items-center gap-2",children:[(0,l.jsx)(O.A,{className:"h-5 w-5"})," AI Summary"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-sm",children:"Calories:"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:o.calories})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-sm",children:"Macros:"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:o.macros})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-semibold text-sm",children:"Hydration:"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:o.hydration})]}),(0,l.jsxs)("div",{className:"bg-primary/10 border-l-4 border-primary text-primary-foreground p-3 rounded-r-lg",children:[(0,l.jsxs)("h4",{className:"font-semibold flex items-center gap-2 text-sm text-primary",children:[(0,l.jsx)(Y.A,{className:"h-5 w-5"})," Key Recommendation:"]}),(0,l.jsx)("p",{className:"text-foreground/90 text-sm",children:o.recommendation})]})]})]})};function ei(e){let{client:s,isOpen:a,onClose:t}=e,{toast:i}=(0,f.dj)(),[d,o]=(0,r.useState)(s),[h,u]=(0,r.useState)(!1),[x,m]=(0,r.useState)(!1),[p,v]=(0,r.useState)(!1),[g,N]=(0,r.useState)(null),[y,w]=(0,r.useState)(!1),C=(0,r.useCallback)(async()=>{if(s.uid){v(!0);try{await V({clientId:s.uid});let e=await (0,F.m)(s.uid);if(e.success&&e.data)o(e.data),i({title:"Stats Refreshed",description:"".concat(s.fullName,"'s summary is now up-to-date.")});else throw Error(e.error||"Could not refetch client data after refresh.")}catch(e){i({variant:"destructive",title:"Update Failed",description:e.message})}finally{v(!1)}}},[s.uid,s.fullName,i]);(0,r.useEffect)(()=>{a&&s.uid?(o(s),"coaching"===s.tier&&U(s.uid).then(e=>{e.success&&e.chatId&&N({id:e.chatId,name:"".concat(s.fullName," Coaching")})})):N(null)},[a,s]);let S=async()=>{if(null==d?void 0:d.uid){u(!0);try{let e=await L(d.uid);if(e.success)i({title:"Client Deleted",description:"The client and their data have been removed."}),t();else throw Error(e.error||"Could not delete the client.")}catch(e){i({variant:"destructive",title:"Deletion Failed",description:e.message})}finally{u(!1),m(!1)}}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.lG,{open:a,onOpenChange:t,children:(0,l.jsxs)(b.Cf,{className:"w-[90vw] h-[90dvh] max-w-4xl flex flex-col",children:[(0,l.jsx)(b.c7,{className:"p-4 border-b",children:(0,l.jsxs)(b.L3,{srOnly:!0,children:[(null==d?void 0:d.fullName)||"Client","'s Command Center"]})}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full",children:(0,l.jsx)("div",{className:"p-4",children:d&&(0,l.jsxs)(et.Accordion,{type:"single",collapsible:!0,defaultValue:"item-1",className:"w-full space-y-4",children:[(0,l.jsxs)(et.AccordionItem,{value:"item-1",className:"border rounded-lg overflow-hidden",children:[(0,l.jsx)(et.AccordionTrigger,{className:"p-4 hover:no-underline",children:(0,l.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,l.jsx)(G.A,{className:"mr-2 h-5 w-5"}),(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("h3",{className:"font-semibold text-base text-left",children:"At-a-Glance Stats"})})]})}),(0,l.jsx)(et.AccordionContent,{className:"p-4 pt-0",children:(0,l.jsx)(E,{client:d,onDeleteClient:()=>m(!0),onRefresh:C,isRefreshing:p})})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)(n.$,{onClick:()=>w(!0),disabled:!g,children:[(0,l.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Open Chat"]}),(0,l.jsx)(W,{client:d})]}),(0,l.jsxs)(et.AccordionItem,{value:"item-2",className:"border rounded-lg overflow-hidden",children:[(0,l.jsxs)(et.AccordionTrigger,{className:"p-4 hover:no-underline",children:[(0,l.jsx)(H.A,{className:"mr-2 h-5 w-5"})," AI Client Insight"]}),(0,l.jsx)(et.AccordionContent,{className:"p-4 pt-0",children:(0,l.jsx)(er,{client:d})})]}),(0,l.jsxs)(et.AccordionItem,{value:"item-5",className:"border rounded-lg overflow-hidden",children:[(0,l.jsxs)(et.AccordionTrigger,{className:"p-4 hover:no-underline",children:[(0,l.jsx)(_.A,{className:"mr-2 h-5 w-5"})," Coach Notes"]}),(0,l.jsx)(et.AccordionContent,{className:"p-4 pt-0",children:(0,l.jsx)(ea,{client:d})})]})]})})})}),(0,l.jsx)(b.Es,{className:"p-4 border-t",children:(0,l.jsx)(n.$,{variant:"outline",onClick:t,children:"Close"})}),(0,l.jsx)(J.Lt,{open:x,onOpenChange:m,children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsxs)(J.r7,{children:["Delete ",null==d?void 0:d.fullName,"?"]}),(0,l.jsx)(J.$v,{children:"This action is irreversible. It will permanently delete the client's account, all their data, and their access to the app."})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:S,disabled:h,className:"bg-destructive hover:bg-destructive/90",children:[h&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Client"]})]})]})})]})}),g&&(0,l.jsx)(en.R,{isOpen:y,onClose:()=>w(!1),chatId:g.id,chatName:g.name})]})}var ec=a(22544),ed=a(66942),eo=a(98734),eh=a(41052),eu=a(65142),ex=a(92649),em=a(61352),ej=a(27304),ep=a(18274),ef=a(36204),ev=a(33173),eg=a(80991),eN=a(50909),ey=a(45458);let eb=eo.Ik({email:eo.Yj().email(),password:eo.Yj().min(8,"Password must be at least 8 characters"),fullName:eo.Yj().min(2,"Please enter client's full name."),tier:eo.k5(i.qc),birthdate:eo.Yj().refine(e=>!e||new Date(e)<new Date,{message:"Birthdate must be in the past."}),sex:eo.k5(["male","female","unspecified"]),units:eo.k5(["imperial","metric"]),height:eo.au.number({invalid_type_error:"Height is required"}).positive("Height must be a positive number"),weight:eo.au.number({invalid_type_error:"Weight is required"}).positive("Weight must be a positive number"),waist:eo.au.number({invalid_type_error:"Waist is required"}).positive("Waist must be a positive number"),zipCode:eo.Yj().regex(/^\d{5}$/,"Please enter a valid 5-digit zip code."),activityLevel:eo.k5(["sedentary","light","moderate","active","very_active"]),wakeTime:eo.Yj(),sleepTime:eo.Yj()}),ew={free:{name:"Free",price:"$0",yearPrice:"",features:["Core Pillar Tracking (Nutrition, Activity, Sleep, Hydration)","Limited Insights","Ad-Supported"],icon:ex.A,cta:"Start for Free"},"ad-free":{name:"Ad-Free",price:"$1.99/mo",yearPrice:"$19.99/yr",features:["Everything in Free","Ad-Free Experience"],icon:em.A,cta:"Go Ad-Free"},basic:{name:"Basic",price:"$4.99/mo",yearPrice:"$49.99/yr",features:["Everything in Ad-Free","Full Biometric & Habit Tracking","75/20/20 Protocol & Planner Tools","Personalized Insights & Trends"],icon:ex.A,cta:"Choose Basic"},premium:{name:"Premium",price:"$7.99/mo",yearPrice:"$79.99/yr",features:["Everything in Basic","Community Challenges","Group Messaging"],icon:ej.A,cta:"Go Premium",highlight:!0},coaching:{name:"Coaching",price:"$199.99/mo",yearPrice:"",features:["Everything in Premium","1-on-1 Human Coaching","Personalized Meal & Activity Plans","Priority Support"],icon:ep.A,cta:"Start Coaching"}};function eC(e){let{onFormSubmit:s,onCancel:a}=e,{toast:c}=(0,f.dj)(),[d,o]=(0,r.useState)(!1),[h,u]=(0,r.useState)(1),x=(0,ec.mN)({resolver:(0,ed.u)(eb),defaultValues:{email:"",password:"",fullName:"",tier:"basic",birthdate:"",sex:"unspecified",units:"imperial",height:0,weight:0,waist:0,zipCode:"",activityLevel:"light",wakeTime:"07:00",sleepTime:"22:00"}}),m=async()=>{let e=[];1===h&&(e=["email","password","fullName","tier"]),2===h&&(e=["birthdate","sex","units","height","weight","waist","zipCode"]),await x.trigger(e)&&u(e=>e+1)};async function p(e){o(!0),await s(e),o(!1)}return(0,l.jsxs)(t.Zp,{className:"w-full shadow-none border-none",children:[(0,l.jsxs)(t.aR,{children:[(0,l.jsx)(t.ZB,{className:"text-2xl text-center",children:"Onboard New Client"}),(0,l.jsxs)(t.BT,{className:"text-center",children:["Complete the client's profile. (Step ",h," of ",3,")"]}),(0,l.jsx)(eg.k,{value:h/3*100,className:"mt-4"})]}),(0,l.jsx)(eh.lV,{...x,children:(0,l.jsxs)("form",{onSubmit:x.handleSubmit(p),children:[(0,l.jsxs)(t.Wu,{className:"space-y-6",children:[1===h&&(0,l.jsxs)("div",{className:"space-y-4 animate-in fade-in",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg",children:"Account Details"}),(0,l.jsx)(eh.zB,{control:x.control,name:"fullName",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Client's Full Name"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"Jane Doe",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"email",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Client's Email"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"client@example.com",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"password",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Temporary Password"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"password",placeholder:"••••••••",...s})}),(0,l.jsx)(eh.Rr,{children:"The client will be prompted to change this on first login."}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"tier",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Assign Tier"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select a tier for the client"})})}),(0,l.jsx)(el.gC,{children:i.qc.map(e=>{var s;let a=(null==(s=ew[e])?void 0:s.icon)||ex.A;return(0,l.jsx)(el.eb,{value:e,children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(a,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"capitalize",children:e})]})},e)})})]}),(0,l.jsx)(eh.Rr,{children:"Selecting 'Coaching' will automatically create a private chat."}),(0,l.jsx)(eh.C5,{})]})}})]}),2===h&&(0,l.jsxs)("div",{className:"space-y-4 animate-in fade-in",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg",children:"Client's Metrics"}),(0,l.jsx)(eh.zB,{control:x.control,name:"birthdate",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Birthdate"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"date",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"sex",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-2",children:[(0,l.jsx)(eh.lR,{children:"Sex"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(eN.z,{onValueChange:s.onChange,defaultValue:s.value,className:"flex space-x-4",children:[(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-2 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"male"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Male"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-2 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"female"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Female"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-2 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"unspecified"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Prefer not to say"})]})]})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"height",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)(eh.lR,{children:["Height (","imperial"===x.watch("units")?"in":"cm",")"]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"weight",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)(eh.lR,{children:["Weight (","imperial"===x.watch("units")?"lbs":"kg",")"]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"waist",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)(eh.lR,{children:["Waist (","imperial"===x.watch("units")?"in":"cm",")"]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"units",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-3",children:[(0,l.jsx)(eh.lR,{children:"Units of Measure"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(eN.z,{onValueChange:s.onChange,defaultValue:s.value,className:"flex space-x-4",children:[(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-2 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"imperial"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Imperial"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-2 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"metric"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Metric"})]})]})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"zipCode",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Zip Code"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., 90210",...s})}),(0,l.jsx)(eh.C5,{})]})}})]})]}),3===h&&(0,l.jsxs)("div",{className:"space-y-4 animate-in fade-in",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg",children:"Client's Lifestyle"}),(0,l.jsx)(eh.zB,{control:x.control,name:"activityLevel",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-3",children:[(0,l.jsx)(eh.lR,{children:"Approximate Activity Level"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(eN.z,{onValueChange:s.onChange,defaultValue:s.value,className:"flex flex-col space-y-1",children:[(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"sedentary"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Sedentary (little or no exercise)"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"light"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Lightly active (light exercise/sports 1-3 days/week)"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"moderate"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Moderately active (moderate exercise/sports 3-5 days/week)"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"active"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Very active (hard exercise/sports 6-7 days a week)"})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"very_active"})}),(0,l.jsx)(eh.lR,{className:"font-normal",children:"Extra active (very hard exercise/sports & physical job)"})]})]})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"wakeTime",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Approx. Wake Up Time"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"time",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"sleepTime",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Approx. Bedtime"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"time",...s})}),(0,l.jsx)(eh.C5,{})]})}})]})]})]}),(0,l.jsxs)(t.wL,{className:"flex justify-between",children:[(0,l.jsx)("div",{children:h>1?(0,l.jsxs)(n.$,{type:"button",variant:"ghost",onClick:()=>u(e=>e-1),children:[(0,l.jsx)(ef.A,{className:"mr-2 h-4 w-4"}),"Previous"]}):(0,l.jsx)(n.$,{type:"button",variant:"ghost",onClick:a,children:"Cancel"})}),(0,l.jsxs)("div",{children:[h<3&&(0,l.jsxs)(n.$,{type:"button",onClick:m,children:["Next",(0,l.jsx)(ev.A,{className:"ml-2 h-4 w-4"})]}),3===h&&(0,l.jsxs)(n.$,{type:"submit",disabled:d,children:[d&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Client Account"]})]})]})]})})]})}let eS=(0,v.createServerReference)("40caae047fa02f116982a2335577669647e3fab523",v.callServer,void 0,v.findSourceMapURL,"createClientByCoachAction");function eA(e){let{open:s,onOpenChange:a,onClientCreated:t}=e,{toast:n}=(0,f.dj)(),{user:r}=(0,K.A)(),i=async e=>{if(!r)return n({variant:"destructive",title:"Authentication Error",description:"You must be logged in to create a client."}),{success:!1,error:{message:"User not authenticated"}};let s={...e,coachId:r.uid};try{var a;let l=await eS(s);if(l.success)return n({title:"Client Created Successfully!",description:"".concat(e.fullName," has been added and their private chat has been initiated.")}),t(),{success:!0};throw Error((null==(a=l.error)?void 0:a.message)||"An unknown error occurred.")}catch(s){console.error("Client creation failed:",s);let e=s.message||"An unexpected error occurred during sign up.";return(e.includes("email-already-in-use")||e.includes("EMAIL_EXISTS"))&&(e="This email address is already in use by another account."),n({variant:"destructive",title:"Client Creation Failed",description:e}),{success:!1,error:{message:e}}}};return(0,l.jsx)(b.lG,{open:s,onOpenChange:a,children:(0,l.jsxs)(b.Cf,{className:"w-[90vw] h-[90dvh] max-w-4xl flex flex-col",children:[(0,l.jsx)(b.c7,{children:(0,l.jsx)(b.L3,{srOnly:!0,children:"Onboard New Client"})}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full pr-6 -mr-6",children:(0,l.jsx)(eC,{onFormSubmit:i,onCancel:()=>a(!1)})})})]})})}var ek=a(6943),eM=a(28263),eI=a(88964),eR=a(15239),eD=a(55428),ez=a(24793),eT=a(63853),eP=a(5282),eE=a(76444),eB=a(26333),eF=a(50276),eU=a(17482),eL=a(44193),eV=a(64269);let e$=(0,v.createServerReference)("40186d9946c7e5882c13ff6e10cb58525b79e2d8f2",v.callServer,void 0,v.findSourceMapURL,"upsertChallengeAction");var eJ=a(35437),eO=a(81962),eY=a(3203);let eG=(0,a(83101).F)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),eH=r.createContext({size:"default",variant:"default"}),e_=r.forwardRef((e,s)=>{let{className:a,variant:t,size:n,children:r,...i}=e;return(0,l.jsx)(eY.bL,{ref:s,className:(0,eV.cn)("flex items-center justify-center gap-1",a),...i,children:(0,l.jsx)(eH.Provider,{value:{variant:t,size:n},children:r})})});e_.displayName=eY.bL.displayName;let eq=r.forwardRef((e,s)=>{let{className:a,children:t,variant:n,size:i,...c}=e,d=r.useContext(eH);return(0,l.jsx)(eY.q7,{ref:s,className:(0,eV.cn)(eG({variant:d.variant||n,size:d.size||i}),a),...c,children:t})});eq.displayName=eY.q7.displayName;let eW=eo.Ik({description:eo.Yj().min(1,"Task description cannot be empty."),startDay:eo.au.number().min(1,"Start day must be at least 1."),unit:eo.k5(["reps","seconds","minutes"]),goalType:eo.k5(["static","progressive","user-records"]),goal:eo.au.number().optional(),startingGoal:eo.au.number().optional(),increaseBy:eo.au.number().optional(),increaseEvery:eo.k5(["week","2-weeks","month"]).optional(),notes:eo.Yj().optional()}).superRefine((e,s)=>{"static"===e.goalType?(!e.goal||e.goal<=0)&&s.addIssue({code:eL.eq.custom,message:"Goal must be at least 1.",path:["goal"]}):"progressive"===e.goalType&&((!e.startingGoal||e.startingGoal<=0)&&s.addIssue({code:eL.eq.custom,message:"Starting goal must be at least 1.",path:["startingGoal"]}),(!e.increaseBy||e.increaseBy<=0)&&s.addIssue({code:eL.eq.custom,message:"Increase must be at least 1.",path:["increaseBy"]}),e.increaseEvery||s.addIssue({code:eL.eq.custom,message:"Please select a frequency.",path:["increaseEvery"]}))}),eX=eo.Ik({pillarId:eo.Yj().min(1,"Please select a pillar."),days:eo.YO(eo.Yj()).min(1,"You must select at least one day."),recurrenceType:eo.k5(["weekly","custom"]),recurrenceInterval:eo.au.number().optional(),notes:eo.Yj().optional()}).superRefine((e,s)=>{"custom"===e.recurrenceType&&(!e.recurrenceInterval||e.recurrenceInterval<=0)&&s.addIssue({code:eL.eq.custom,message:"Interval must be at least 1.",path:["recurrenceInterval"]})}),eZ=eo.Ik({habitId:eo.Yj().min(1,"Please select a habit."),days:eo.YO(eo.Yj()).min(1,"You must select at least one day."),recurrenceType:eo.k5(["weekly","custom"]),recurrenceInterval:eo.au.number().optional(),notes:eo.Yj().optional()}).superRefine((e,s)=>{"custom"===e.recurrenceType&&(!e.recurrenceInterval||e.recurrenceInterval<=0)&&s.addIssue({code:eL.eq.custom,message:"Interval must be at least 1.",path:["recurrenceInterval"]})}),eK=eo.Ik({id:eo.Yj().optional(),name:eo.Yj().min(5,"Challenge name must be at least 5 characters."),description:eo.Yj().min(10,"Description must be at least 10 characters."),startDate:eo.p6({required_error:"A start date is required."}),durationDays:eo.au.number().min(1,"Duration must be at least 1 day."),maxParticipants:eo.au.number().min(1,"Must have at least one participant."),thumbnailUrl:eo.Yj().optional(),notes:eo.Yj().optional(),scheduledPillars:eo.YO(eX).optional(),customTasks:eo.YO(eW).optional(),scheduledHabits:eo.YO(eZ).optional()}).refine(e=>e.scheduledPillars&&e.scheduledPillars.length>0||e.customTasks&&e.customTasks.length>0||e.scheduledHabits&&e.scheduledHabits.length>0,{message:"A challenge must have at least one pillar, custom task, or scheduled habit.",path:["scheduledPillars"]});function eQ(e){var s,a,t;let{open:i,onOpenChange:c,onChallengeUpserted:d,initialData:o}=e,{toast:h}=(0,f.dj)(),[x,p]=(0,r.useState)((null==o?void 0:o.thumbnailUrl)||null),[v,g]=(0,r.useState)([]),N=!!o;(0,r.useEffect)(()=>{i&&(0,eO.l)().then(e=>{e.success&&e.data&&g(e.data)})},[i]);let y=(0,ec.mN)({resolver:(0,ed.u)(eK),defaultValues:o?{...o,startDate:o.startDate?new Date(o.startDate):new Date,customTasks:(null==(s=o.customTasks)?void 0:s.map(e=>({description:e.description||"",startDay:e.startDay||1,unit:e.unit||"reps",goalType:e.goalType||"static",goal:e.goal||void 0,startingGoal:e.startingGoal||void 0,increaseBy:e.increaseBy||void 0,increaseEvery:e.increaseEvery||void 0,notes:e.notes||""})))||[],scheduledHabits:(null==(a=o.scheduledHabits)?void 0:a.map(e=>({...e,recurrenceType:e.recurrenceType||"weekly"})))||[],scheduledPillars:(null==(t=o.scheduledPillars)?void 0:t.map(e=>({...e,recurrenceType:e.recurrenceType||"weekly"})))||[]}:{name:"",description:"",startDate:new Date,durationDays:7,maxParticipants:100,notes:"",thumbnailUrl:"",scheduledPillars:[],customTasks:[],scheduledHabits:[]}}),{fields:C,append:S,remove:A}=(0,ec.jz)({control:y.control,name:"scheduledPillars"}),{fields:k,append:M,remove:I}=(0,ec.jz)({control:y.control,name:"customTasks"}),{fields:R,append:D,remove:z}=(0,ec.jz)({control:y.control,name:"scheduledHabits"}),T=y.watch("scheduledPillars"),P=y.watch("customTasks"),E=y.watch("scheduledHabits");(0,r.useEffect)(()=>{E&&0!==v.length&&E.forEach((e,s)=>{if(e.habitId){let a=v.find(s=>s.id===e.habitId),l=y.getValues("scheduledHabits.".concat(s,".notes"));a&&(!l||v.some(e=>e.description===l))&&y.setValue("scheduledHabits.".concat(s,".notes"),a.description,{shouldDirty:!0})}})},[E,v,y]);let F=e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(a){let e=new FileReader;e.onloadend=()=>{let s=e.result;p(s),y.setValue("thumbnailUrl",s,{shouldValidate:!0})},e.readAsDataURL(a)}},U=async e=>{try{let a=await e$(e);if(a.success)h({title:"Challenge ".concat(N?"Updated":"Created","!"),description:"".concat(e.name," has been successfully saved.")}),null==d||d(),c(!1),y.reset(),p(null);else{var s;throw Error((null==(s=a.error)?void 0:s.message)||"Could not save the challenge.")}}catch(e){console.error("Error saving challenge:",e),h({variant:"destructive",title:"Save Failed",description:e.message})}};return(0,l.jsx)(b.lG,{open:i,onOpenChange:c,children:(0,l.jsx)(b.Cf,{className:"w-[90vw] h-[90dvh] max-w-4xl flex flex-col",children:(0,l.jsx)(eh.lV,{...y,children:(0,l.jsxs)("form",{onSubmit:y.handleSubmit(U),className:"flex-1 flex flex-col min-h-0",children:[(0,l.jsxs)(b.c7,{className:"p-6",children:[(0,l.jsxs)(b.L3,{children:[N?"Edit":"Create New"," Community Challenge"]}),(0,l.jsx)(b.rr,{children:N?"Update the details for this challenge.":"Design an engaging challenge to motivate your community."})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full",children:(0,l.jsxs)("div",{className:"space-y-6 py-4 px-6",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Challenge Name"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Hydration Harmony Quest",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"description",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Description"}),(0,l.jsx)(eh.Rr,{children:"Explain the goals and benefits of this challenge."}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., Track hydration to reduce cravings and boost energy!",...s,maxLength:1e3})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"startDate",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Start Date"}),(0,l.jsxs)(eB.AM,{children:[(0,l.jsx)(eB.Wv,{asChild:!0,children:(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(n.$,{variant:"outline",className:(0,eV.cn)("w-full justify-start text-left font-normal",!s.value&&"text-muted-foreground"),children:[(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4"}),s.value?(0,eP.GP)(s.value,"PPP"):(0,l.jsx)("span",{children:"Pick a date"})]})})}),(0,l.jsx)(eB.hl,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(eF.V,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"durationDays",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Duration (in days)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,l.jsx)(eh.zB,{control:y.control,name:"maxParticipants",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Max Participants"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}})}),(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(eh.lR,{children:"Scheduled Pillars"}),(0,l.jsx)(eh.Rr,{children:"Define which core pillars to track and when."})]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>S({pillarId:"",days:[],recurrenceType:"weekly",notes:""}),children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Add Pillar Block"]})]}),(0,l.jsx)("div",{className:"space-y-2 rounded-md border p-4",children:0===C.length?(0,l.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"No scheduled pillars added yet."}):C.map((e,s)=>(0,l.jsxs)("div",{className:"p-3 rounded-md bg-muted/50 border space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledPillars.".concat(s,".pillarId"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex-1",children:[(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select a pillar..."})})}),(0,l.jsx)(el.gC,{children:eJ.S.filter(e=>"insights"!==e.id).map(e=>{let s=e.icon||ex.A;return(0,l.jsx)(el.eb,{value:e.id,children:(0,l.jsxs)("span",{className:"flex items-center gap-2",children:[(0,l.jsx)(s,{className:"h-4 w-4"})," ",e.label]})},e.id)})})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>A(s),children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledPillars.".concat(s,".days"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Days of the Week"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(e_,{type:"multiple",variant:"outline",size:"sm",className:"justify-start gap-1",value:s.value,onValueChange:s.onChange,children:[(0,l.jsx)(eq,{value:"sun",children:"S"}),(0,l.jsx)(eq,{value:"mon",children:"M"}),(0,l.jsx)(eq,{value:"tue",children:"T"}),(0,l.jsx)(eq,{value:"wed",children:"W"}),(0,l.jsx)(eq,{value:"thu",children:"T"}),(0,l.jsx)(eq,{value:"fri",children:"F"}),(0,l.jsx)(eq,{value:"sat",children:"S"})]})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledPillars.".concat(s,".recurrenceType"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-2",children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Recurrence"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select recurrence..."})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"weekly",children:"Weekly"}),(0,l.jsx)(el.eb,{value:"custom",children:"Custom Interval"})]})]})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledPillars.".concat(s,".recurrenceInterval"),render:e=>{var a;let{field:t}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Repeat every (days)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{placeholder:"e.g., 14",disabled:(null==T||null==(a=T[s])?void 0:a.recurrenceType)!=="custom",...t})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledPillars.".concat(s,".notes"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Notes/Instructions"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., Focus on hitting your protein goal today.",...s})}),(0,l.jsx)(eh.C5,{})]})}})]},e.id))})]}),(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(eh.lR,{children:"Scheduled Habits"}),(0,l.jsx)(eh.Rr,{children:"Define recurring weekly habits for this challenge."})]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>D({habitId:"",days:[],recurrenceType:"weekly",notes:""}),children:[(0,l.jsx)(O.A,{className:"mr-2 h-4 w-4"}),"Add Habit Block"]})]}),(0,l.jsx)("div",{className:"space-y-2 rounded-md border p-4",children:0===R.length?(0,l.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"No scheduled habits added yet."}):R.map((e,s)=>(0,l.jsxs)("div",{className:"p-3 rounded-md bg-muted/50 border space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledHabits.".concat(s,".habitId"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex-1",children:[(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select a habit..."})})}),(0,l.jsx)(el.gC,{children:v.map(e=>(0,l.jsx)(el.eb,{value:e.id,children:e.name},e.id))})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>z(s),children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledHabits.".concat(s,".days"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Days of the Week"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(e_,{type:"multiple",variant:"outline",size:"sm",className:"justify-start gap-1",value:s.value,onValueChange:s.onChange,children:[(0,l.jsx)(eq,{value:"sun",children:"S"}),(0,l.jsx)(eq,{value:"mon",children:"M"}),(0,l.jsx)(eq,{value:"tue",children:"T"}),(0,l.jsx)(eq,{value:"wed",children:"W"}),(0,l.jsx)(eq,{value:"thu",children:"T"}),(0,l.jsx)(eq,{value:"fri",children:"F"}),(0,l.jsx)(eq,{value:"sat",children:"S"})]})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledHabits.".concat(s,".recurrenceType"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-2",children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Recurrence"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select recurrence..."})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"weekly",children:"Weekly"}),(0,l.jsx)(el.eb,{value:"custom",children:"Custom Interval"})]})]})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledHabits.".concat(s,".recurrenceInterval"),render:e=>{var a;let{field:t}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Repeat every (days)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{placeholder:"e.g., 14",disabled:(null==E||null==(a=E[s])?void 0:a.recurrenceType)!=="custom",...t})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"scheduledHabits.".concat(s,".notes"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Notes/Instructions"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., Take a moment to reflect on why this habit is important to you.",...s})}),(0,l.jsx)(eh.C5,{})]})}})]},e.id))})]}),(0,l.jsxs)(eh.eI,{children:[(0,l.jsxs)("div",{className:"flex justify-between items-center",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(eh.lR,{children:"Custom Daily Exercises"}),(0,l.jsx)(eh.Rr,{children:"Define specific, measurable exercises for this challenge."})]}),(0,l.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>M({description:"",startDay:1,unit:"reps",goalType:"static",goal:10,notes:""}),children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Add Exercise"]})]}),(0,l.jsx)("div",{className:"space-y-2 rounded-md border p-4",children:0===k.length?(0,l.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"No custom exercises added yet."}):k.map((e,s)=>{var a,t;return(0,l.jsxs)("div",{className:"flex flex-col gap-2 p-2 rounded-md bg-muted/50 border",children:[(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",className:"text-destructive h-8 w-8",onClick:()=>I(s),children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})}),(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".description"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Description"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Push Ups",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".startDay"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Start Day"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{placeholder:"1",...s})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".unit"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Unit"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Unit"})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"reps",children:"Reps"}),(0,l.jsx)(el.eb,{value:"seconds",children:"Seconds"}),(0,l.jsx)(el.eb,{value:"minutes",children:"Minutes"})]})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".goalType"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Goal Type"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select goal type..."})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"static",children:"Static Goal"}),(0,l.jsx)(el.eb,{value:"progressive",children:"Progressive Goal"}),(0,l.jsx)(el.eb,{value:"user-records",children:"User Records"})]})]}),(0,l.jsx)(eh.C5,{})]})}})]}),P&&(null==(a=P[s])?void 0:a.goalType)==="static"&&(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".goal"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Goal"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),P&&(null==(t=P[s])?void 0:t.goalType)==="progressive"&&(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".startingGoal"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Starting Goal"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".increaseBy"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Increase By"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ey.d,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".increaseEvery"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Increase Every"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Frequency"})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"week",children:"Week"}),(0,l.jsx)(el.eb,{value:"2-weeks",children:"2 Weeks"}),(0,l.jsx)(el.eb,{value:"month",children:"Month"})]})]}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"customTasks.".concat(s,".notes"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Modification Notes"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., If this is too hard, try knee push-ups.",...s})}),(0,l.jsx)(eh.C5,{})]})}})]})]},e.id)})})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{children:"Challenge Thumbnail"}),(0,l.jsx)(eh.Rr,{children:"Upload a thumbnail image for the challenge."}),(0,l.jsxs)("div",{className:"p-4 border rounded-md space-y-4",children:[(0,l.jsx)(eh.zB,{control:y.control,name:"thumbnailUrl",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"file",accept:"image/*",onChange:F,className:"file:text-primary file:font-semibold"})}),(0,l.jsx)(eh.C5,{})]})}}),x?(0,l.jsx)("div",{className:"relative w-full h-40 rounded-lg overflow-hidden border",children:(0,l.jsx)(eR.default,{src:x,alt:"Thumbnail preview",fill:!0,className:"object-cover",unoptimized:!0})}):(0,l.jsx)("div",{className:"w-full h-40 rounded-lg bg-muted flex items-center justify-center",children:(0,l.jsx)(eU.A,{className:"h-12 w-12 text-muted-foreground"})})]})]}),(0,l.jsx)(eh.zB,{control:y.control,name:"notes",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Schedule & Instructions"}),(0,l.jsx)(eh.Rr,{children:"Explain how the tasks should be performed (e.g., daily, or escalating weekly)."}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., Week 1: Perform as written. Week 2: Double all reps.",...s,maxLength:1e3})}),(0,l.jsx)(eh.C5,{})]})}})]})})}),(0,l.jsxs)(b.Es,{className:"pt-4 border-t mt-4 flex-shrink-0",children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{type:"submit",disabled:y.formState.isSubmitting,children:[y.formState.isSubmitting&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),N?"Update Challenge":"Create Challenge"]})]})]})})})})}var e0=a(98173);let e1=(0,v.createServerReference)("40fcb44bcd347bc520dce1dc85fdf0aeb6cf16e206",v.callServer,void 0,v.findSourceMapURL,"deleteChallengeAction");var e4=a(6259),e2=a(13406);let e5=(0,v.createServerReference)("403e6092586a387957811705d9bec4abb9d5980983",v.callServer,void 0,v.findSourceMapURL,"saveCustomHabitAction"),e3=(0,v.createServerReference)("402337b71f145187e00c1c8e293b3bfe1c88a88683",v.callServer,void 0,v.findSourceMapURL,"deleteCustomHabitAction");var e6=a(95409);function e7(e){let{open:s,onOpenChange:a,title:t,description:n,children:r,className:i,footer:c}=e;return(0,l.jsx)(e6.d,{isOpen:s,onClose:a,title:t,description:n,className:i,footer:c,children:r})}let e8=eo.Ik({name:eo.Yj().min(3,"Habit name must be at least 3 characters."),description:eo.Yj().min(5,"Description must be at least 5 characters.")});function e9(e){var s;let{open:a,onOpenChange:t}=e,{toast:i}=(0,f.dj)(),[c,d]=(0,r.useState)([]),[o,h]=(0,r.useState)(!0),[u,x]=(0,r.useState)(null),[p,v]=(0,r.useState)({open:!1,habit:null}),g=(0,ec.mN)({resolver:(0,ed.u)(e8),defaultValues:{name:"",description:""}}),N=(0,r.useCallback)(async()=>{h(!0);let e=await (0,eO.l)();e.success&&e.data?d(e.data):i({variant:"destructive",title:"Error",description:"Could not fetch custom habits."}),h(!1)},[i]);(0,r.useEffect)(()=>{a&&N()},[a,N]);let y=async e=>{let s=await e5(e);s.success?(i({title:"Habit Saved!",description:"".concat(e.name," has been added to your library.")}),g.reset(),N()):i({variant:"destructive",title:"Error",description:s.error})},b=async()=>{if(!p.habit)return;x(p.habit.id);let e=await e3(p.habit.id);e.success?(i({title:"Habit Deleted"}),N()):i({variant:"destructive",title:"Error",description:e.error}),x(null),v({open:!1,habit:null})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e7,{open:a,onOpenChange:t,title:"Manage Custom Habits",description:"Create and manage reusable habits for your challenges.",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 h-full",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg",children:"Create New Habit"}),(0,l.jsx)(eh.lV,{...g,children:(0,l.jsxs)("form",{onSubmit:g.handleSubmit(y),className:"space-y-4",children:[(0,l.jsx)(eh.zB,{control:g.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Habit Name"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Mindful Eating",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:g.control,name:"description",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Description"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"Describe the purpose of this habit...",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)(n.$,{type:"submit",disabled:g.formState.isSubmitting,children:[g.formState.isSubmitting?(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Save Habit"]})]})})]}),(0,l.jsxs)("div",{className:"flex flex-col border rounded-lg",children:[(0,l.jsx)("h3",{className:"font-semibold text-lg p-4 border-b",children:"Habit Library"}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full",children:(0,l.jsx)("div",{className:"p-4 space-y-2",children:o?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(j.A,{className:"h-8 w-8 animate-spin"})}):c.length>0?c.map(e=>(0,l.jsxs)("div",{className:"flex items-start justify-between gap-2 rounded-md border p-2",children:[(0,l.jsxs)("div",{className:"flex-1",children:[(0,l.jsx)("p",{className:"font-semibold text-sm",children:e.name}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-8 w-8 flex-shrink-0",onClick:()=>v({open:!0,habit:e}),disabled:u===e.id,children:u===e.id?(0,l.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(w.A,{className:"h-4 w-4 text-destructive"})})]},e.id)):(0,l.jsx)("p",{className:"text-sm text-center text-muted-foreground py-10",children:"No custom habits created yet."})})})})]})]})}),(0,l.jsx)(J.Lt,{open:p.open,onOpenChange:()=>v({open:!1,habit:null}),children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsx)(J.r7,{children:"Are you absolutely sure?"}),(0,l.jsxs)(J.$v,{children:['This will permanently delete the habit "',null==(s=p.habit)?void 0:s.name,'". This action cannot be undone.']})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:b,className:"bg-destructive hover:bg-destructive/90",disabled:!!u,children:[u&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Habit"]})]})]})})]})}function se(e){var s,a;let{open:t,onOpenChange:i}=e,{toast:d}=(0,f.dj)(),[o,h]=(0,r.useState)([]),[u,x]=(0,r.useState)(!0),[p,v]=(0,r.useState)({open:!1,challenge:null}),[g,N]=(0,r.useState)(!1),[y,b]=(0,r.useState)({open:!1,chatInfo:null}),[C,S]=(0,r.useState)({open:!1,challenge:null}),[A,k]=(0,r.useState)(!1),M=(0,r.useCallback)(async()=>{x(!0);let e=await (0,e0.m)();if(e.success&&e.data)h(e.data);else{var s;d({variant:"destructive",title:"Error",description:(null==(s=e.error)?void 0:s.message)||"Could not fetch challenges."})}x(!1)},[d]);(0,r.useEffect)(()=>{t&&M()},[t,M]);let{upcoming:I,active:R,past:D}=(0,r.useMemo)(()=>{let e=[],s=[],a=[];return o.forEach(l=>{let t=new Date(l.dates.from),n=new Date(l.dates.to);(0,eD.R)(n)?a.push(l):(0,ez.G)(t)?e.push(l):s.push(l)}),{upcoming:e,active:s,past:a}},[o]),z=async()=>{if(C.challenge){k(!0);try{let e=await e1(C.challenge.id);if(e.success)d({title:"Success",description:"The challenge has been deleted."}),M();else throw Error(e.error||"Failed to delete challenge.")}catch(e){d({title:"Error",description:e.message,variant:"destructive"})}finally{k(!1),S({open:!1,challenge:null})}}},T=e=>{let{list:s}=e;return(0,l.jsx)("div",{className:"space-y-2",children:s.length>0?s.map(e=>(0,l.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border p-1.5 bg-card text-card-foreground",children:[(0,l.jsx)("div",{className:"relative w-10 h-10 flex-shrink-0",children:(0,l.jsx)(eR.default,{src:e.thumbnailUrl||"https://placehold.co/100x100.png",alt:e.name,fill:!0,className:"object-cover rounded-md",unoptimized:!0})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-semibold text-xs truncate",children:e.name}),(0,l.jsxs)("p",{className:"text-[10px] text-muted-foreground",children:[(0,eP.GP)(new Date(e.dates.from),"MMM d")," - ",(0,eP.GP)(new Date(e.dates.to),"MMM d, yyyy")]}),(0,l.jsxs)("p",{className:"text-[10px] text-muted-foreground flex items-center gap-1",children:[(0,l.jsx)(ek.A,{className:"w-3 h-3"})," ",e.participantCount," / ",e.maxParticipants]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-0",children:[(0,l.jsx)(n.$,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>b({open:!0,chatInfo:{id:e.id,name:e.name}}),children:(0,l.jsx)(c.A,{className:"h-3.5 w-3.5"})}),(0,l.jsxs)(e4.rI,{children:[(0,l.jsx)(e4.ty,{asChild:!0,children:(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7 flex-shrink-0",children:(0,l.jsx)(eM.A,{className:"h-4 w-4"})})}),(0,l.jsxs)(e4.SQ,{align:"end",children:[(0,l.jsxs)(e4._2,{onClick:()=>{v({open:!0,challenge:{...e,startDate:new Date(e.dates.from),durationDays:(0,eT.B)(new Date(e.dates.to),{unit:"day",addSuffix:!1}).split(" ")[0]}})},children:[(0,l.jsx)(eI.A,{className:"mr-2 h-4 w-4"})," Edit"]}),(0,l.jsx)(e4.mB,{}),(0,l.jsxs)(e4._2,{onClick:()=>S({open:!0,challenge:e}),className:"text-destructive",children:[(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})]})]},e.id)):(0,l.jsx)("div",{className:"text-center text-muted-foreground p-8 text-sm",children:(0,l.jsx)("p",{children:"No challenges in this category."})})})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e7,{open:t,onOpenChange:i,title:"Manage Challenges",description:"Create, edit, and view community challenges.",footer:(0,l.jsxs)("div",{className:"flex justify-between w-full",children:[(0,l.jsx)(n.$,{onClick:()=>N(!0),size:"sm",variant:"outline",children:"Custom Habits"}),(0,l.jsxs)(n.$,{onClick:()=>v({open:!0,challenge:null}),size:"sm",className:"gap-1",children:[(0,l.jsx)(m.A,{className:"h-4 w-4"})," New Challenge"]})]}),children:u?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,l.jsxs)(e2.tU,{defaultValue:"active",className:"w-full h-full flex flex-col",children:[(0,l.jsxs)(e2.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsx)(e2.Xi,{value:"active",children:"Active"}),(0,l.jsx)(e2.Xi,{value:"upcoming",children:"Upcoming"}),(0,l.jsx)(e2.Xi,{value:"past",children:"Past"})]}),(0,l.jsxs)("div",{className:"flex-1 min-h-0 mt-2",children:[(0,l.jsx)(e2.av,{value:"active",className:"h-full m-0",children:(0,l.jsx)(T,{list:R})}),(0,l.jsx)(e2.av,{value:"upcoming",className:"h-full m-0",children:(0,l.jsx)(T,{list:I})}),(0,l.jsx)(e2.av,{value:"past",className:"h-full m-0",children:(0,l.jsx)(T,{list:D})})]})]})}),(0,l.jsx)(eQ,{open:p.open,onOpenChange:e=>v({open:e,challenge:null}),onChallengeUpserted:M,initialData:p.challenge},(null==(s=p.challenge)?void 0:s.id)||"new"),y.chatInfo&&(0,l.jsx)(en.R,{chatId:y.chatInfo.id,chatName:y.chatInfo.name,isOpen:y.open,onClose:()=>b({open:!1,chatInfo:null})}),(0,l.jsx)(e9,{open:g,onOpenChange:N}),(0,l.jsx)(J.Lt,{open:C.open,onOpenChange:()=>S({open:!1,challenge:null}),children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsx)(J.r7,{children:"Are you absolutely sure?"}),(0,l.jsxs)(J.$v,{children:['This will permanently delete the challenge "',null==(a=C.challenge)?void 0:a.name,'". This action cannot be undone.']})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:z,className:"bg-destructive hover:bg-destructive/90",disabled:A,children:[A&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Challenge"]})]})]})})]})}var ss=a(27314);let sa=(0,v.createServerReference)("40e444d30ad43851deec46cc42b014af120a0fe00e",v.callServer,void 0,v.findSourceMapURL,"savePopupAction");var sl=a(30848),st=a(41808),sn=a(90109);let sr=r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(st.uB,{ref:s,className:(0,eV.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...t})});sr.displayName=st.uB.displayName;let si=r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,l.jsx)(sn.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,l.jsx)(st.uB.Input,{ref:s,className:(0,eV.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...t})]})});si.displayName=st.uB.Input.displayName;let sc=r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(st.uB.List,{ref:s,className:(0,eV.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...t})});sc.displayName=st.uB.List.displayName;let sd=r.forwardRef((e,s)=>(0,l.jsx)(st.uB.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));sd.displayName=st.uB.Empty.displayName;let so=r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(st.uB.Group,{ref:s,className:(0,eV.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...t})});so.displayName=st.uB.Group.displayName,r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(st.uB.Separator,{ref:s,className:(0,eV.cn)("-mx-1 h-px bg-border",a),...t})}).displayName=st.uB.Separator.displayName;let sh=r.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,l.jsx)(st.uB.Item,{ref:s,className:(0,eV.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",a),...t})});function su(e){var s;let{options:a,value:t,onChange:i,placeholder:c,searchPlaceholder:d,modal:o=!1}=e,[h,u]=r.useState(!1),x=t||"";return(0,l.jsxs)(eB.AM,{open:h,onOpenChange:u,modal:o,children:[(0,l.jsx)(eB.Wv,{asChild:!0,children:(0,l.jsxs)(n.$,{variant:"outline",role:"combobox","aria-expanded":h,className:"w-full justify-between",children:[x?null==(s=a.find(e=>e.value===x))?void 0:s.label:c||"Select option...",(0,l.jsx)(sl.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,l.jsx)(eB.hl,{className:"w-[--radix-popover-trigger-width)] p-0",children:(0,l.jsxs)(sr,{filter:(e,s)=>+!!e.toLowerCase().includes(s.toLowerCase()),children:[(0,l.jsx)(si,{placeholder:d||"Search..."}),(0,l.jsxs)(sc,{children:[(0,l.jsx)(sd,{children:"No option found."}),(0,l.jsx)(so,{children:a.map(e=>(0,l.jsxs)(sh,{value:e.label,onSelect:()=>{i(e.value),u(!1)},children:[(0,l.jsx)(p.A,{className:(0,eV.cn)("mr-2 h-4 w-4",x===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})]})]})})]})}sh.displayName=st.uB.Item.displayName;let sx=eo.Ik({id:eo.Yj().optional(),name:eo.Yj().min(3,"Campaign name is required."),title:eo.Yj().min(3,"Title is required."),message:eo.Yj().min(10,"Message is required."),imageUrl:eo.Yj().optional(),ctaText:eo.Yj().min(2,"Button text is required."),ctaUrl:eo.Yj().url("Please enter a valid URL.").optional().or(eo.eu("")),scheduledAt:eo.p6(),targetType:eo.k5(["all","tier","user"]),targetValue:eo.Yj().optional()}).refine(e=>"tier"!==e.targetType&&"user"!==e.targetType||!!e.targetValue,{message:"A target value is required for this target type.",path:["targetValue"]});function sm(e){let{open:s,onOpenChange:a,onPopupSaved:t,initialData:c}=e,{toast:d}=(0,f.dj)(),{user:o}=(0,K.A)(),[h,x]=(0,r.useState)(null),[m,p]=(0,r.useState)([]),v=!!c,N=(0,ec.mN)({resolver:(0,ed.u)(sx),defaultValues:{id:void 0,name:"",title:"",message:"",imageUrl:"",ctaText:"Learn More",ctaUrl:"",scheduledAt:new Date,targetType:"all",targetValue:""}});(0,r.useEffect)(()=>{let e=async()=>{if(!o)return;let e=await g();e.success&&e.data?p(e.data):(p([]),d({variant:"destructive",title:"Error",description:"Could not fetch client list."}))};if(s){e();let s={id:(null==c?void 0:c.id)||void 0,name:(null==c?void 0:c.name)||"",title:(null==c?void 0:c.title)||"",message:(null==c?void 0:c.message)||"",imageUrl:(null==c?void 0:c.imageUrl)||"",ctaText:(null==c?void 0:c.ctaText)||"Learn More",ctaUrl:(null==c?void 0:c.ctaUrl)||"",scheduledAt:(null==c?void 0:c.scheduledAt)?new Date(c.scheduledAt):new Date,targetType:(null==c?void 0:c.targetType)||"all",targetValue:(null==c?void 0:c.targetValue)||""};N.reset(s),x((null==c?void 0:c.imageUrl)||null)}},[s,c,N,o,d]);let y=async e=>{try{let s=await sa(e);if(s.success)d({title:"Success!",description:"Pop-up campaign has been ".concat(v?"updated":"created",".")}),null==t||t(),a(!1);else throw Error(s.error||"An unknown error occurred")}catch(e){console.error("Popup save failed:",e),d({title:"Save Failed",description:e.message,variant:"destructive"})}},w=N.watch("targetType"),C=m.map(e=>({value:e.uid,label:"".concat(e.fullName," (").concat(e.email,")")}));return(0,l.jsx)(eh.lV,{...N,children:(0,l.jsx)("form",{id:"popup-form",onSubmit:N.handleSubmit(y),children:(0,l.jsx)(e6.d,{isOpen:s,onClose:()=>a(!1),title:v?"Edit Pop-up Campaign":"Create New Pop-up Campaign",className:"max-w-2xl",footer:(0,l.jsxs)(b.Es,{children:[(0,l.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{type:"submit",form:"popup-form",disabled:N.formState.isSubmitting,children:[N.formState.isSubmitting&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),v?"Update Campaign":"Create & Schedule"]})]}),children:(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(eh.zB,{control:N.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Campaign Name (Internal)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Summer Coaching Discount",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:N.control,name:"title",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Title"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Limited Time Offer!",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:N.control,name:"message",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Message"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"Describe your promotion or announcement...",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Image"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"file",accept:"image/*",onChange:e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(a){let e=new FileReader;e.onloadend=()=>{x(e.result),N.setValue("imageUrl",e.result)},e.readAsDataURL(a)}},className:"file:text-primary file:font-semibold"})})]}),h&&(0,l.jsx)("div",{className:"relative w-full h-40 rounded-lg overflow-hidden border",children:(0,l.jsx)(eR.default,{src:h,alt:"Pop-up preview",fill:!0,className:"object-cover",unoptimized:!0})}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,l.jsx)(eh.zB,{control:N.control,name:"ctaText",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Button Text (CTA)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:N.control,name:"ctaUrl",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Button Link (URL)"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"https://example.com/offer",...s})}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)(eh.zB,{control:N.control,name:"scheduledAt",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-2",children:[(0,l.jsx)(eh.lR,{children:"Schedule Time"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,l.jsxs)(eB.AM,{children:[(0,l.jsx)(eB.Wv,{asChild:!0,children:(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(n.$,{variant:"outline",className:(0,eV.cn)("w-full pl-3 text-left font-normal",!s.value&&"text-muted-foreground"),children:[s.value?(0,eP.GP)(s.value,"PPP"):(0,l.jsx)("span",{children:"Pick a date"}),(0,l.jsx)(u.A,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),(0,l.jsx)(eB.hl,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(eF.V,{mode:"single",selected:s.value,onSelect:e=>{if(!e)return;let a=new Date(s.value);a.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),s.onChange(a)},initialFocus:!0})})]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"time",value:s.value instanceof Date&&!isNaN(s.value.getTime())?(0,eP.GP)(s.value,"HH:mm"):"",onChange:e=>{let[a,l]=e.target.value.split(":").map(Number),t=new Date(s.value);t.setHours(a,l),s.onChange(t)}})})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:N.control,name:"targetType",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Audience"}),(0,l.jsxs)(el.l6,{onValueChange:e=>{s.onChange(e),N.setValue("targetValue","")},value:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select an audience"})})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"all",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ek.A,{})," All Users"]})}),(0,l.jsx)(el.eb,{value:"tier",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ep.A,{})," By Tier"]})}),(0,l.jsx)(el.eb,{value:"user",children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(ss.A,{})," Specific User"]})})]})]}),(0,l.jsx)(eh.C5,{})]})}}),"tier"===w&&(0,l.jsx)(eh.zB,{control:N.control,name:"targetValue",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Select Tier"}),(0,l.jsxs)(el.l6,{onValueChange:s.onChange,value:s.value,children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{placeholder:"Select a tier"})})}),(0,l.jsx)(el.gC,{children:i.qc.map(e=>(0,l.jsx)(el.eb,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,l.jsx)(eh.C5,{})]})}}),"user"===w&&(0,l.jsx)(eh.zB,{control:N.control,name:"targetValue",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Select Client"}),(0,l.jsx)(su,{options:C,value:s.value||"",onChange:s.onChange,placeholder:"Select client...",searchPlaceholder:"Search by name or email...",modal:!0}),(0,l.jsx)(eh.C5,{})]})}})]})})})})}let sj=(0,v.createServerReference)("00ef438b3d0a90d89fa6530c7c0ea275f3e3517922",v.callServer,void 0,v.findSourceMapURL,"getPopupsForCoach"),sp=(0,v.createServerReference)("405dfd91fe7a151d91d26592f5abaa39baf19c2b20",v.callServer,void 0,v.findSourceMapURL,"deletePopupAction");function sf(e){var s;let{open:a,onOpenChange:t}=e,{toast:i}=(0,f.dj)(),{user:c}=(0,K.A)(),[d,o]=(0,r.useState)({open:!1,popup:null}),[h,u]=(0,r.useState)([]),[x,p]=(0,r.useState)(!0),[v,g]=(0,r.useState)(!1),[N,y]=(0,r.useState)({open:!1,popupId:null}),b=(0,r.useCallback)(async()=>{p(!0);let e=await sj();e.success&&e.data?u(e.data):i({title:"Error",description:e.error||"Could not fetch pop-up campaigns.",variant:"destructive"}),p(!1)},[i]);(0,r.useEffect)(()=>{a&&b()},[a,b]);let{active:C,scheduled:S,past:A}=(0,r.useMemo)(()=>{let e=[],s=[],a=[],l=new Date;return h.forEach(t=>{let n=new Date(t.scheduledAt);l>new Date(n.getTime()+864e5)?a.push(t):n>l?s.push(t):e.push(t)}),{active:e,scheduled:s,past:a}},[h]),k=async()=>{if(N.popupId){g(!0);try{let e=await sp(N.popupId);if(e.success)i({title:"Success",description:"Pop-up campaign has been deleted."}),b();else throw Error(e.error||"Failed to delete campaign.")}catch(e){i({title:"Error",description:e.message,variant:"destructive"})}finally{g(!1),y({open:!1,popupId:null})}}},M={all:{icon:ek.A,label:"All Users"},tier:{icon:ep.A,label:"By Tier"},user:{icon:ss.A,label:"Specific User"}},I=e=>{let{list:s}=e;return 0===s.length?(0,l.jsx)("div",{className:"text-center text-muted-foreground p-8 text-sm",children:(0,l.jsx)("p",{children:"No campaigns in this category."})}):(0,l.jsx)("div",{className:"space-y-2",children:s.map(e=>{var s;let a=(null==(s=M[e.targetType])?void 0:s.icon)||ek.A;return(0,l.jsxs)("div",{className:"flex flex-col gap-2 rounded-lg border p-2 bg-card text-card-foreground",children:[(0,l.jsxs)("div",{className:"flex items-start gap-2",children:[e.imageUrl&&(0,l.jsx)("div",{className:"relative w-12 h-12 flex-shrink-0",children:(0,l.jsx)(eR.default,{src:e.imageUrl,alt:e.title,fill:!0,className:"object-cover rounded-md",unoptimized:!0})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-semibold text-xs truncate",children:e.title}),(0,l.jsx)("p",{className:"text-xs text-muted-foreground line-clamp-1",children:e.message})]}),(0,l.jsxs)("div",{className:"flex items-center gap-0 self-start",children:[(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>o({open:!0,popup:e}),children:(0,l.jsx)(eI.A,{className:"h-3.5 w-3.5"})}),(0,l.jsxs)(e4.rI,{children:[(0,l.jsx)(e4.ty,{asChild:!0,children:(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7 flex-shrink-0",children:(0,l.jsx)(eM.A,{className:"h-4 w-4"})})}),(0,l.jsx)(e4.SQ,{align:"end",children:(0,l.jsxs)(e4._2,{onClick:()=>y({open:!0,popupId:e.id,popupName:e.name}),className:"text-destructive",children:[(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Delete"]})})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground border-t border-white/10 pt-1.5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)(a,{className:"w-3 h-3"}),(0,l.jsxs)("span",{className:"capitalize",children:[e.targetType,e.targetValue&&": ".concat(e.targetValue)]})]}),(0,l.jsx)("span",{children:(0,eP.GP)(new Date(e.scheduledAt),"MMM d, h:mm a")})]})]},e.id)})})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e7,{open:a,onOpenChange:t,title:"Manage Pop-ups",description:"Create and schedule targeted pop-up announcements for your users.",footer:(0,l.jsx)("div",{className:"flex justify-end w-full",children:(0,l.jsxs)(n.$,{onClick:()=>o({open:!0,popup:null}),size:"sm",className:"gap-2",children:[(0,l.jsx)(m.A,{})," New Pop-up"]})}),children:x?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,l.jsxs)(e2.tU,{defaultValue:"active",className:"w-full h-full flex flex-col",children:[(0,l.jsxs)(e2.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsx)(e2.Xi,{value:"active",children:"Active"}),(0,l.jsx)(e2.Xi,{value:"scheduled",children:"Scheduled"}),(0,l.jsx)(e2.Xi,{value:"past",children:"Past"})]}),(0,l.jsxs)("div",{className:"flex-1 min-h-0 mt-2",children:[(0,l.jsx)(e2.av,{value:"active",className:"h-full m-0",children:(0,l.jsx)(I,{list:C})}),(0,l.jsx)(e2.av,{value:"scheduled",className:"h-full m-0",children:(0,l.jsx)(I,{list:S})}),(0,l.jsx)(e2.av,{value:"past",className:"h-full m-0",children:(0,l.jsx)(I,{list:A})})]})]})}),(0,l.jsx)(sm,{open:d.open,onOpenChange:e=>o({open:e,popup:null}),onPopupSaved:b,initialData:d.popup},(null==(s=d.popup)?void 0:s.id)||"new"),(0,l.jsx)(J.Lt,{open:N.open,onOpenChange:()=>y({open:!1,popupId:null}),children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsx)(J.r7,{children:"Are you absolutely sure?"}),(0,l.jsxs)(J.$v,{children:['This will permanently delete the "',N.popupName||"this",'" campaign. This action cannot be undone.']})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:k,className:"bg-destructive hover:bg-destructive/90",disabled:v,children:[v&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Campaign"]})]})]})})]})}var sv=a(5225),sg=a(53489),sN=a(61774);let sy=(0,v.createServerReference)("608a84c3fa212408e970858e32bb9074cfc017796d",v.callServer,void 0,v.findSourceMapURL,"updateDocumentTextAction");var sb=a(55073),sw=a(24128),sC=a(52619),sS=a.n(sC),sA=a(46767);function sk(e){let{onUploadSuccess:s,user:a}=e,{toast:t}=(0,f.dj)(),[i,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!1),[h,u]=(0,r.useState)(null),[x,p]=(0,r.useState)(""),v=(0,r.useRef)(null),g=async()=>{if(!h||!(null==a?void 0:a.uid)||!(null==a?void 0:a.displayName))return void t({variant:"destructive",title:"Error",description:"File and user information are required."});o(!0);try{let e=new FileReader;e.readAsDataURL(h),e.onload=async()=>{let l=e.result,n=await (0,sN.P)(l,h.name,h.type,x,a.uid,a.displayName);if(n.success)t({title:"Upload Successful",description:'"'.concat(h.name,'" has been added.')}),s(),c(!1),u(null),p("");else throw Error(n.error||"Upload failed")}}catch(e){t({variant:"destructive",title:"Upload Error",description:e.message})}finally{o(!1)}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(sA.m_,{children:[(0,l.jsx)(sA.k$,{asChild:!0,children:(0,l.jsx)(n.$,{onClick:()=>c(!0),disabled:d,variant:"outline",size:"sm",children:d?(0,l.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(m.A,{className:"h-4 w-4"})})}),(0,l.jsx)(sA.ZI,{children:(0,l.jsx)("p",{children:"Upload Document"})})]}),(0,l.jsx)(b.lG,{open:i,onOpenChange:c,children:(0,l.jsxs)(b.Cf,{children:[(0,l.jsxs)(b.c7,{children:[(0,l.jsx)(b.L3,{children:"Upload New Document"}),(0,l.jsx)(b.rr,{children:"Select a file and provide its text content for the AI."})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"file-upload",children:"Step 1: Select File"}),(0,l.jsx)(eu.p,{id:"file-upload",type:"file",ref:v,onChange:e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];a&&u(a)},accept:".pdf,.doc,.docx,.txt"}),h&&(0,l.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected: ",h.name]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"file-content",children:"Step 2: Paste Content"}),(0,l.jsx)(X.T,{id:"file-content",placeholder:"Paste the full text content of the document here...",rows:10,value:x,onChange:e=>p(e.target.value)})]})]}),(0,l.jsxs)(b.Es,{children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{onClick:g,disabled:d||!h||!x,children:[d&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Upload"]})]})]})})]})}function sM(e){let{doc:s,onUpdateSuccess:a,open:t,onOpenChange:i}=e,{toast:c}=(0,f.dj)(),[d,o]=(0,r.useState)(!1),[h,u]=(0,r.useState)("");if((0,r.useEffect)(()=>{s&&u(s.text||"")},[s]),!s)return null;let x=async()=>{o(!0);try{let e=await sy(s.id,h);if(e.success)c({title:"Content Updated"}),a(),i(!1);else throw Error(e.error||"Failed to update content.")}catch(e){c({variant:"destructive",title:"Error",description:e.message})}finally{o(!1)}};return(0,l.jsx)(b.lG,{open:t,onOpenChange:i,children:(0,l.jsxs)(b.Cf,{className:"max-w-3xl h-[80vh] flex flex-col",children:[(0,l.jsx)(b.c7,{children:(0,l.jsxs)(b.L3,{children:['Edit Content for "',s.name,'"']})}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(X.T,{placeholder:"Text content of the document...",className:"h-full resize-none",value:h,onChange:e=>u(e.target.value)})}),(0,l.jsxs)(b.Es,{children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>i(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{onClick:x,disabled:d,children:[d&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Content"]})]})]})})}function sI(e){var s;let{open:a,onOpenChange:t}=e,{toast:i}=(0,f.dj)(),{user:c}=(0,K.A)(),[d,o]=(0,r.useState)([]),[h,u]=(0,r.useState)(!0),[x,m]=(0,r.useState)(null),[p,v]=(0,r.useState)({open:!1,doc:null}),[g,N]=(0,r.useState)({open:!1,doc:null}),y=(0,r.useCallback)(async()=>{u(!0);let e=await (0,sb.s)();e.success&&e.data?o(e.data):i({variant:"destructive",title:"Error",description:"Could not fetch library documents."}),u(!1)},[i]);(0,r.useEffect)(()=>{a&&y()},[a,y]);let b=async()=>{if(p.doc){m(p.doc.id);try{let e=await (0,sw.h)(p.doc.id,p.doc.storagePath);if(e.success)i({title:"Document Deleted",description:'"'.concat(p.doc.name,'" has been removed.')}),y();else throw Error(e.error||"Failed to delete document.")}catch(e){i({variant:"destructive",title:"Deletion Error",description:e.message})}finally{m(null),v({open:!1,doc:null})}}};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(sA.Bc,{children:(0,l.jsx)(e7,{open:a,onOpenChange:t,title:"Document Library",description:"Upload and manage documents to power the AI's knowledge base.",footer:(0,l.jsx)("div",{className:"flex justify-end w-full",children:(0,l.jsx)(sk,{onUploadSuccess:y,user:c})}),children:h?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,l.jsx)("div",{className:"space-y-1.5",children:d.length>0?d.map(e=>{let s=e.name.length>20?"".concat(e.name.substring(0,17),"..."):e.name,a=(e=>{if(!e)return"";let s=e.split(" ");return s.length>1?"".concat(s[0][0]).concat(s[s.length-1][0]).toUpperCase():e.charAt(0).toUpperCase()})(e.coachName);return(0,l.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border p-2 pr-1",children:[(0,l.jsx)(sv.A,{className:"h-5 w-5 text-muted-foreground flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"text-xs font-medium truncate",title:e.name,children:s}),(0,l.jsxs)("p",{className:"text-xs text-muted-foreground truncate",children:[a," - ",(0,eP.GP)(new Date(e.createdAt),"MM/dd/yy")]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-0 flex-shrink-0",children:[(0,l.jsx)(n.$,{variant:"ghost",size:"icon",asChild:!0,children:(0,l.jsx)(sS(),{href:e.url,target:"_blank",download:!0,children:(0,l.jsx)(sg.A,{className:"h-4 w-4"})})}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>N({open:!0,doc:e}),children:(0,l.jsx)(_.A,{className:"h-4 w-4"})}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>v({open:!0,doc:e}),disabled:x===e.id,children:x===e.id?(0,l.jsx)(j.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(w.A,{className:"h-4 w-4 text-destructive"})})]})]},e.id)}):(0,l.jsx)("div",{className:"text-center text-muted-foreground py-16",children:(0,l.jsx)("p",{children:"No documents have been uploaded yet."})})})})}),(0,l.jsx)(sM,{open:g.open,onOpenChange:e=>N({open:e,doc:null}),doc:g.doc,onUpdateSuccess:y}),(0,l.jsx)(J.Lt,{open:p.open,onOpenChange:e=>!e&&v({open:!1,doc:null}),children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsx)(J.r7,{children:"Are you absolutely sure?"}),(0,l.jsxs)(J.$v,{children:['This action cannot be undone. This will permanently delete the document "',null==(s=p.doc)?void 0:s.name,"\" from the AI's knowledge base."]})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:b,className:"bg-destructive hover:bg-destructive/90",disabled:!!x,children:[x&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete"]})]})]})})]})}var sR=a(19695);let sD=(0,v.createServerReference)("00497b32b5c4983dc8fbc64119eccb537e05c4be4a",v.callServer,void 0,v.findSourceMapURL,"getChatsAndClientsForCoach"),sz=(0,v.createServerReference)("600c599437029e6db59377d0d1a083ab6ae1aae247",v.callServer,void 0,v.findSourceMapURL,"deleteChatAction");var sT=a(61270),sP=a(26615);let sE=(0,v.createServerReference)("401ab66f217ed56b11ec73a3b2348f634601c3d6d5",v.callServer,void 0,v.findSourceMapURL,"createChatAction"),sB=eo.Ik({name:eo.Yj().min(3,"Chat name must be at least 3 characters."),description:eo.Yj().min(10,"Description must be at least 10 characters."),type:eo.k5(["open","private_group"]),rules:eo.Yj().optional(),participantIds:eo.YO(eo.Yj()).optional()}).refine(e=>"open"!==e.type||!!e.rules&&!(e.rules.length<10),{message:"Rules are required for open chats and must be at least 10 characters.",path:["rules"]});function sF(e){var s;let{open:a,onOpenChange:t,onChatCreated:i}=e,{toast:c}=(0,f.dj)(),[d,o]=(0,r.useState)([]),[h,u]=(0,r.useState)(!1),x=(0,ec.mN)({resolver:(0,ed.u)(sB),defaultValues:{name:"",description:"",type:"open",rules:"",participantIds:[]}});(0,r.useEffect)(()=>{a&&(u(!0),g().then(e=>{e.success&&e.data&&o(e.data.filter(e=>"premium"===e.tier||"coaching"===e.tier)),u(!1)}))},[a]);let m=async e=>{u(!0);try{let s=await sE(e);if(s.success)c({title:"Chat Created!",description:"".concat(e.name," is now live.")}),i(),t(!1),x.reset();else throw Error(s.error||"An unknown error occurred.")}catch(e){c({variant:"destructive",title:"Error",description:e.message})}finally{u(!1)}},p=d.map(e=>({value:e.uid,label:"".concat(e.fullName," (").concat(e.email,")")})),v=x.watch("type");return(0,l.jsx)(b.lG,{open:a,onOpenChange:t,children:(0,l.jsxs)(b.Cf,{className:"max-w-2xl w-[90vw] h-[90vh] flex flex-col",children:[(0,l.jsxs)(b.c7,{children:[(0,l.jsx)(b.L3,{children:"Create a New Chat"}),(0,l.jsx)(b.rr,{children:"Build a new community space for your clients."})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full",children:(0,l.jsx)("div",{className:"px-6 py-4",children:(0,l.jsx)(eh.lV,{...x,children:(0,l.jsxs)("form",{onSubmit:x.handleSubmit(m),className:"space-y-4",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"name",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Chat Name"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Mindful Eating Group",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"description",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Description"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"What is this chat about?",...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"type",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"space-y-3",children:[(0,l.jsx)(eh.lR,{children:"Chat Type"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(eN.z,{onValueChange:s.onChange,defaultValue:s.value,className:"flex flex-col sm:flex-row gap-4",children:[(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"open"})}),(0,l.jsxs)(eh.lR,{className:"font-normal flex items-center gap-2",children:[(0,l.jsx)(ek.A,{}),"Open to All Premium+"]})]}),(0,l.jsxs)(eh.eI,{className:"flex items-center space-x-3 space-y-0",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eN.C,{value:"private_group"})}),(0,l.jsxs)(eh.lR,{className:"font-normal flex items-center gap-2",children:[(0,l.jsx)(sT.A,{}),"Private Group"]})]})]})}),(0,l.jsx)(eh.C5,{})]})}}),"open"===v&&(0,l.jsx)(eh.zB,{control:x.control,name:"rules",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Chat Rules"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{placeholder:"e.g., 1. Be supportive and respectful. 2. No medical advice. 3. Share wins and struggles.",...s,rows:4})}),(0,l.jsx)(eh.Rr,{children:"Users must agree to these rules before joining."}),(0,l.jsx)(eh.C5,{})]})}}),"private_group"===v&&(0,l.jsx)(eh.zB,{control:x.control,name:"participantIds",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Add Participants"}),(0,l.jsx)(su,{options:p,placeholder:"Select a client to add...",searchPlaceholder:"Search clients...",value:"",onChange:e=>{var a;!e||(null==(a=s.value)?void 0:a.includes(e))||s.onChange([...s.value||[],e])}}),(0,l.jsx)(eh.C5,{})]})}}),"private_group"===v&&x.getValues("participantIds")&&x.getValues("participantIds").length>0&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h4",{className:"text-sm font-medium",children:"Selected Participants"}),(0,l.jsx)("div",{className:"flex flex-wrap gap-2",children:null==(s=x.getValues("participantIds"))?void 0:s.map(e=>{let s=d.find(s=>s.uid===e);return(0,l.jsxs)("div",{className:"flex items-center gap-2 text-sm bg-muted p-1 px-2 rounded-md",children:[(0,l.jsx)("span",{children:(null==s?void 0:s.fullName)||e}),(0,l.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",className:"h-5 w-5",onClick:()=>{var s;let a=null==(s=x.getValues("participantIds"))?void 0:s.filter(s=>s!==e);x.setValue("participantIds",a)},children:(0,l.jsx)(sP.A,{className:"h-3 w-3"})})]},e)})})]})]})})})})}),(0,l.jsxs)(b.Es,{children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{type:"submit",form:"create-chat-form",disabled:h,onClick:x.handleSubmit(m),children:[h&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Chat"]})]})]})})}function sU(e){var s;let{open:a,onOpenChange:t}=e,{toast:i}=(0,f.dj)(),{user:d}=(0,K.A)(),[o,h]=(0,r.useState)([]),[u,x]=(0,r.useState)([]),[m,p]=(0,r.useState)(!0),[v,g]=(0,r.useState)({activeCoachingChats:[],miaCoachingChats:[],groupChats:[]}),[y,b]=(0,r.useState)(!1),[C,S]=(0,r.useState)({open:!1,chatInfo:null}),[A,k]=(0,r.useState)({open:!1,chat:null}),[M,I]=(0,r.useState)(!1),[R,D]=(0,r.useState)(!1),z=(0,r.useCallback)(async()=>{p(!0);let e=await sD();if(e.success&&e.data)h(e.data.chats),x(e.data.clients);else{var s;i({variant:"destructive",title:"Error",description:(null==(s=e.error)?void 0:s.message)||"Could not fetch chats."})}p(!1)},[i]);(0,r.useEffect)(()=>{a&&z()},[a,z]),(0,r.useEffect)(()=>{if(m)return;let e=[],s=[];o.forEach(a=>{"coaching"===a.type?e.push(a):s.push(a)});let a=new Date,l=[],t=[];e.forEach(e=>{let s=e.lastClientMessage?new Date(e.lastClientMessage).getTime():0;s>0&&48>(0,sR.M)(a,s)?l.push(e):t.push(e)}),l.sort((e,s)=>{let a=e.lastClientMessage?new Date(e.lastClientMessage).getTime():0,l=e.lastCoachMessage?new Date(e.lastCoachMessage).getTime():0,t=s.lastClientMessage?new Date(s.lastClientMessage).getTime():0,n=s.lastCoachMessage?new Date(s.lastCoachMessage).getTime():0;return a>l&&t<=n?-1:a<=l&&t>n?1:a>l&&t>n?a-t:l-n}),t.sort((e,s)=>{let a=Math.max(e.lastAutomatedMessage?new Date(e.lastAutomatedMessage).getTime():0,e.lastClientMessage?new Date(e.lastClientMessage).getTime():0);return a-Math.max(s.lastAutomatedMessage?new Date(s.lastAutomatedMessage).getTime():0,s.lastClientMessage?new Date(s.lastClientMessage).getTime():0)}),s.sort((e,s)=>{let a=new Date(e.lastMessage||e.createdAt||0).getTime();return new Date(s.lastMessage||s.createdAt||0).getTime()-a}),g({activeCoachingChats:l,miaCoachingChats:t,groupChats:s}),b(!0)},[o,u,m]);let T=async()=>{if(A.chat&&d){I(!0);try{let e=await sz(A.chat.id,d.uid);if(e.success)i({title:"Success",description:"The chat has been deleted."}),z();else throw Error(e.error||"Failed to delete chat.")}catch(e){i({title:"Error",description:e.message,variant:"destructive"})}finally{I(!1),k({open:!1,chat:null})}}},P=e=>{let{list:s}=e;if(0===s.length)return(0,l.jsx)("p",{className:"text-center text-muted-foreground p-8 text-sm",children:"No chats in this category."});let a=new Map(u.map(e=>[e.uid,e]));return(0,l.jsx)("div",{className:"space-y-2",children:s.map(e=>{let s="coaching"===e.type?e.participants.find(e=>!e.startsWith("coach-")&&e!==(null==d?void 0:d.uid)):void 0,t=s?a.get(s):null,r=(null==t?void 0:t.fullName)||e.name;return(0,l.jsxs)("div",{className:"flex items-center gap-2 rounded-lg border p-1.5 bg-card text-card-foreground",children:[(0,l.jsxs)(N.eu,{className:"h-8 w-8 border",children:[(0,l.jsx)(N.BK,{src:(null==t?void 0:t.photoURL)||"",alt:r||"Chat"}),(0,l.jsx)(N.q5,{children:(null==r?void 0:r.charAt(0))||"C"})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-semibold text-xs truncate",children:r}),"coaching"!==e.type&&(0,l.jsxs)("p",{className:"text-[10px] text-muted-foreground truncate",children:[e.participantCount," members"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-0",children:[(0,l.jsx)(n.$,{variant:"outline",size:"icon",className:"h-7 w-7",onClick:()=>S({open:!0,chatInfo:{id:e.id,name:r||e.name}}),children:(0,l.jsx)(c.A,{className:"h-3.5 w-3.5"})}),(0,l.jsxs)(e4.rI,{children:[(0,l.jsx)(e4.ty,{asChild:!0,children:(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7 flex-shrink-0",children:(0,l.jsx)(eM.A,{className:"h-4 w-4"})})}),(0,l.jsx)(e4.SQ,{align:"end",children:(0,l.jsxs)(e4._2,{onClick:()=>k({open:!0,chat:e}),className:"text-destructive",children:[(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Delete"]})})]})]})]},e.id)})})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e7,{open:a,onOpenChange:t,title:"Manage Chats",description:"Review and manage all client and group conversations.",footer:(0,l.jsx)("div",{className:"flex justify-end w-full",children:(0,l.jsx)(n.$,{onClick:()=>D(!0),size:"sm",children:"Create New Chat"})}),children:m?(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,l.jsxs)(e2.tU,{defaultValue:"active",className:"w-full h-full flex flex-col",children:[(0,l.jsxs)(e2.j7,{className:"grid w-full grid-cols-3",children:[(0,l.jsxs)(e2.Xi,{value:"active",children:["Active (",v.activeCoachingChats.length,")"]}),(0,l.jsxs)(e2.Xi,{value:"mia",children:["MIA (",v.miaCoachingChats.length,")"]}),(0,l.jsxs)(e2.Xi,{value:"group",children:["Group (",v.groupChats.length,")"]})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0 mt-2",children:y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e2.av,{value:"active",className:"h-full m-0",children:(0,l.jsx)(P,{list:v.activeCoachingChats})}),(0,l.jsx)(e2.av,{value:"mia",className:"h-full m-0",children:(0,l.jsx)(P,{list:v.miaCoachingChats})}),(0,l.jsx)(e2.av,{value:"group",className:"h-full m-0",children:(0,l.jsx)(P,{list:v.groupChats})})]}):(0,l.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,l.jsx)(j.A,{className:"h-8 w-8 animate-spin"})})})]})}),(0,l.jsx)(sF,{open:R,onOpenChange:D,onChatCreated:z}),C.chatInfo&&(0,l.jsx)(en.R,{chatId:C.chatInfo.id,chatName:C.chatInfo.name,isOpen:C.open,onClose:()=>S({open:!1,chatInfo:null})}),(0,l.jsx)(J.Lt,{open:A.open,onOpenChange:()=>k({open:!1,chat:null}),children:(0,l.jsxs)(J.EO,{children:[(0,l.jsxs)(J.wd,{children:[(0,l.jsx)(J.r7,{children:"Are you absolutely sure?"}),(0,l.jsxs)(J.$v,{children:['This will permanently delete the chat "',null==(s=A.chat)?void 0:s.name,'". This action cannot be undone.']})]}),(0,l.jsxs)(J.ck,{children:[(0,l.jsx)(J.Zr,{children:"Cancel"}),(0,l.jsxs)(J.Rx,{onClick:T,className:"bg-destructive hover:bg-destructive/90",disabled:M,children:[M&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Chat"]})]})]})})]})}let sL=(0,v.createServerReference)("60740ff655e0e52babae4e16d2ca4968f1141ad453",v.callServer,void 0,v.findSourceMapURL,"getCoachEvents");var sV=a(44575),s$=a(90850),sJ=a(51190),sO=a(63263),sY=a(47691),sG=a(98457),sH=a(32078),s_=a(9941);let sq={personal:"bg-blue-500/80 border-blue-700",manual:"bg-green-500/80 border-green-700",zoom:"bg-primary/80 border-primary/90"},sW=e=>{let s,a,{entry:t,onSelect:n}=e,{originalData:r}=t;return r.isPersonal?(s=sV.A,a=sq.personal):r.attendees?(s=s$.A,a=sq.zoom):(s=ss.A,a=sq.manual),(0,l.jsx)("div",{style:{top:"".concat(t.top,"%"),height:"".concat(t.height,"%"),left:"".concat(t.left,"%"),width:"".concat(t.width,"%"),padding:"1px"},className:(0,eV.cn)("absolute rounded-lg overflow-hidden cursor-pointer",a),onClick:()=>n(r),children:(0,l.jsxs)("div",{className:"relative flex items-center gap-1 p-1 text-white h-full bg-black/20 rounded-md",children:[(0,l.jsx)(s,{className:"h-4 w-4 flex-shrink-0"}),(0,l.jsx)("span",{className:"text-[10px] font-medium truncate flex-1",children:r.title}),r.coachName&&(0,l.jsx)(N.eu,{className:"h-4 w-4 flex-shrink-0 border-white/50 border",children:(0,l.jsx)(N.q5,{className:"text-[8px] bg-black/20",children:(e=>{if(!e)return"?";let s=e.split(" ");return s.length>1?"".concat(s[0][0]).concat(s[s.length-1][0]).toUpperCase():e.charAt(0).toUpperCase()})(r.coachName)})})]})})};function sX(e){let{currentDate:s,setCurrentDate:a,events:t,isLoading:i,onEventClick:c}=e,d=(0,r.useRef)(null);(0,r.useEffect)(()=>{!i&&d.current&&d.current.scrollTo({top:360,behavior:"smooth"})},[i]);let o=e=>{a(e>0?(0,sH.f)(s,1):(0,s_.e)(s,1))},h=(0,r.useMemo)(()=>((e,s)=>{if(!e||0===e.length)return[];let a=(0,sY.o)(s),l=e.map(e=>{let s=e.start?new Date(e.start):null,l=e.end?new Date(e.end):null;return s&&l?{id:e.id,startMinutes:Math.max(0,(0,sG.o)(s,a)),endMinutes:Math.min(1440,(0,sG.o)(l,a)),originalData:e}:null}).filter(e=>null!==e&&e.endMinutes>e.startMinutes).sort((e,s)=>e.startMinutes-s.startMinutes||s.endMinutes-e.endMinutes),t=[],n=[];for(let e of l){let s=!1;for(let a of n)if(a.some(s=>e.startMinutes<s.endMinutes&&e.endMinutes>s.startMinutes)){a.push(e),s=!0;break}s||n.push([e])}for(let e of n){e.sort((e,s)=>e.startMinutes-s.startMinutes);let s=[];for(let a of e){let e=!1;for(let l=0;l<s.length;l++)if(s[l].every(e=>a.startMinutes>=e.endMinutes)){s[l].push(a),e=!0;break}e||s.push([a])}let a=100/s.length;for(let e=0;e<s.length;e++)for(let l of s[e]){let s=Math.max(1,l.endMinutes-l.startMinutes)/1440*100;t.push({id:l.id,top:l.startMinutes/1440*100,height:Math.max(s,2.0833),left:e*a,width:a-.5,originalData:l.originalData})}}return t})(t,s),[t,s]),u=Array.from({length:24},(e,s)=>s);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"flex-shrink-0 p-2 flex justify-between items-center border-b",children:[(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>o(-1),children:(0,l.jsx)(sJ.A,{className:"h-5 w-5"})}),(0,l.jsx)("h3",{className:"text-base font-semibold",children:(0,eP.GP)(s,"PPP")}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>o(1),children:(0,l.jsx)(sO.A,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex-1 min-h-0 relative flex",children:[i&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/50 z-20",children:(0,l.jsx)(j.A,{className:"h-8 w-8 animate-spin"})}),(0,l.jsx)(B.F,{className:"h-full w-full",viewportRef:d,children:(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"w-12 flex-shrink-0 pr-1 border-r",children:u.map(e=>(0,l.jsx)("div",{className:"h-[60px] text-right relative -top-2.5",children:(0,l.jsx)("span",{className:"text-[10px] text-muted-foreground pr-1",children:(0,eP.GP)(new Date(0,0,0,e),"ha")})},e))}),(0,l.jsxs)("div",{className:"relative flex-1",children:[u.map(e=>(0,l.jsx)("div",{className:"h-[60px] border-b"},e)),h.map(e=>(0,l.jsx)(sW,{entry:e,onSelect:c},e.id))]})]})})]})]})}var sZ=a(8773),sK=a(39089),sQ=a(63146),s0=a(76273);let s1=Array.from({length:14},(e,s)=>s+6),s4={personal:"bg-blue-500/80 border-blue-700",manual:"bg-green-500/80 border-green-700",zoom:"bg-primary/80 border-primary/90"},s2=e=>{let s,a,{event:t,onEventClick:n}=e,r=(0,sY.o)(new Date(t.start)),i=(0,sG.o)(new Date(t.start),r),c=(0,sG.o)(new Date(t.end),r),d=(i-360)/840*100;return(t.isPersonal?(s=sV.A,a=s4.personal):t.attendees?(s=s$.A,a=s4.zoom):(s=ss.A,a=s4.manual),d<0||d>100)?null:(0,l.jsx)("div",{style:{top:"".concat(d,"%"),height:"".concat((c-i)/840*100,"%")},className:(0,eV.cn)("absolute w-full p-0.5 rounded-md overflow-hidden cursor-pointer",a),onClick:()=>n(t),children:(0,l.jsxs)("div",{className:"relative flex items-center gap-1 p-1 text-white h-full",children:[(0,l.jsx)(s,{className:"h-3 w-3 flex-shrink-0"}),(0,l.jsx)("span",{className:"text-[10px] font-medium truncate",children:t.title})]})})};function s5(e){let{currentDate:s,setCurrentDate:a,events:t,isLoading:i,onEventClick:c,onDayClick:d}=e,o=(0,r.useMemo)(()=>(0,sZ.k)({start:(0,sK.k)(s),end:(0,sQ.$)(s)}),[s]),h=e=>{a("next"===e?(0,sH.f)(s,7):(0,s_.e)(s,7))},u=(0,r.useMemo)(()=>{let e=new Map;for(let s of t){let a=(0,eP.GP)(new Date(s.start),"yyyy-MM-dd");e.has(a)||e.set(a,[]),e.get(a).push(s)}return e},[t]);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-2 border-b flex-shrink-0",children:[(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>h("prev"),children:(0,l.jsx)(sJ.A,{className:"h-5 w-5"})}),(0,l.jsxs)("h3",{className:"text-base font-semibold",children:[(0,eP.GP)(o[0],"MMM d")," - ",(0,eP.GP)(o[6],"MMM d, yyyy")]}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>h("next"),children:(0,l.jsx)(sO.A,{className:"h-5 w-5"})})]}),(0,l.jsxs)("div",{className:"flex flex-col flex-1 min-h-0",children:[(0,l.jsxs)("div",{className:"grid grid-cols-[auto_1fr_1fr_1fr_1fr_1fr_1fr_1fr] flex-shrink-0 sticky top-0 bg-background z-10",children:[(0,l.jsx)("div",{className:"w-12 border-r"}),o.map(e=>(0,l.jsxs)("button",{onClick:()=>d(e),className:(0,eV.cn)("flex flex-col items-center p-1 border-b border-r text-center hover:bg-muted/50",(0,s0.c)(e)&&"bg-primary/10"),children:[(0,l.jsx)("span",{className:(0,eV.cn)("text-xs font-semibold",(0,s0.c)(e)?"text-primary":"text-muted-foreground"),children:(0,eP.GP)(e,"EEE")}),(0,l.jsx)("span",{className:(0,eV.cn)("flex items-center justify-center h-6 w-6 rounded-full text-sm font-bold",(0,s0.c)(e)&&"bg-primary text-primary-foreground"),children:(0,eP.GP)(e,"d")})]},e.toString()))]}),i?(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsx)(j.A,{className:"h-8 w-8 animate-spin"})}):(0,l.jsx)(B.F,{className:"flex-1",children:(0,l.jsxs)("div",{className:"grid grid-cols-[auto_1fr_1fr_1fr_1fr_1fr_1fr_1fr] relative",children:[(0,l.jsx)("div",{className:"w-12",children:s1.map(e=>(0,l.jsx)("div",{className:"h-16 text-right pr-1 border-r -translate-y-2",children:(0,l.jsx)("span",{className:"text-[10px] text-muted-foreground",children:(0,eP.GP)(new Date(0,0,0,e),"ha")})},e))}),o.map(e=>{let s=(0,eP.GP)(e,"yyyy-MM-dd"),a=u.get(s)||[];return(0,l.jsxs)("div",{className:"relative border-r",children:[s1.map(e=>(0,l.jsx)("div",{className:"h-16 border-b"},e)),a.map(e=>(0,l.jsx)(s2,{event:e,onEventClick:c},e.id))]},s)})]})})]})]})}var s3=a(90231),s6=a(79894),s7=a(73181),s8=a(41962),s9=a(55350);function ae(e){let{currentDate:s,setCurrentDate:a,events:t,isLoading:i,onEventClick:c,onDayClick:d}=e,o=(0,r.useMemo)(()=>(0,s3.w)(s),[s]),h=(0,r.useMemo)(()=>(0,sZ.k)({start:(0,sK.k)(o),end:(0,sQ.$)((0,s6.p)(o))}),[o]),u=(0,r.useMemo)(()=>{let e=new Map;for(let s of t){let a=(0,eP.GP)(new Date(s.start),"yyyy-MM-dd");e.has(a)||e.set(a,[]),e.get(a).push(s)}return e},[t]);return(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-2 border-b flex-shrink-0",children:[(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>a((0,s7.a)(s,1)),children:(0,l.jsx)(sJ.A,{className:"h-5 w-5"})}),(0,l.jsx)("h3",{className:"text-base font-semibold",children:(0,eP.GP)(s,"MMMM yyyy")}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",onClick:()=>a((0,s8.P)(s,1)),children:(0,l.jsx)(sO.A,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"grid grid-cols-7 flex-shrink-0",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,l.jsx)("div",{className:"text-center text-xs font-semibold text-muted-foreground p-2 border-b border-r",children:e},e))}),(0,l.jsx)("div",{className:"grid grid-cols-7 grid-rows-6 flex-1 min-h-0",children:h.map(e=>{let a=(0,eP.GP)(e,"yyyy-MM-dd"),t=u.get(a)||[];return(0,l.jsxs)("button",{onClick:()=>d(e),className:(0,eV.cn)("relative border-b border-r p-1.5 flex flex-col gap-1 overflow-y-auto text-left hover:bg-muted/50 transition-colors",!(0,s9.t)(e,s)&&"bg-muted/30"),children:[(0,l.jsx)("span",{className:(0,eV.cn)("text-xs font-semibold",(0,s0.c)(e)?"bg-primary text-primary-foreground rounded-full h-5 w-5 flex items-center justify-center":"text-muted-foreground"),children:(0,eP.GP)(e,"d")}),(0,l.jsxs)("div",{className:"space-y-1",children:[t.slice(0,2).map(e=>{let s,a;return e.isPersonal?(s=sV.A,a="bg-blue-500/20 text-blue-300"):e.attendees?(s=s$.A,a="bg-primary/20 text-primary"):(s=ss.A,a="bg-green-500/20 text-green-300"),(0,l.jsxs)("div",{className:(0,eV.cn)("w-full text-left text-xs p-1 rounded-md flex items-start gap-1.5 pointer-events-none",a),children:[(0,l.jsx)(s,{className:"h-3.5 w-3.5 mt-0.5 flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsx)("p",{className:"font-semibold truncate",children:e.title}),(0,l.jsx)("p",{className:"truncate opacity-80",children:(0,eP.GP)(new Date(e.start),"p")})]})]},e.id)}),t.length>2&&(0,l.jsxs)("div",{className:"text-center text-xs text-muted-foreground pt-1",children:["+ ",t.length-2," more"]})]})]},a)})})]})}var as=a(6713),aa=a(55879),al=a(92658),at=a(44846);let an=eo.Ik({id:eo.Yj().optional(),title:eo.Yj().min(1,"Title is required."),start:eo.p6(),description:eo.Yj().optional(),clientId:eo.Yj().optional().nullable(),clientName:eo.Yj().optional().nullable(),isPersonal:eo.zM().default(!1),attachVideoLink:eo.zM().default(!1),durationDays:eo.au.number().min(0).optional(),durationHours:eo.au.number().min(0).optional(),durationMinutes:eo.au.number().min(0).optional()});function ar(e){let{isOpen:s,onClose:a,event:t}=e,{toast:i}=(0,f.dj)(),{user:c}=(0,K.A)(),[d,o]=(0,r.useState)([]),[h,u]=(0,r.useState)(!1),x=(0,ec.mN)({resolver:(0,ed.u)(an),defaultValues:{title:"",start:new Date,durationDays:0,durationHours:1,durationMinutes:0,description:"",clientId:null,clientName:null,isPersonal:!1,attachVideoLink:!1}});(0,r.useEffect)(()=>{if(s)if(g().then(e=>{e.success&&e.data&&o(e.data.filter(e=>"premium"===e.tier||"coaching"===e.tier))}),t){let e=new Date(t.start),s=Math.floor((new Date(t.end).getTime()-e.getTime())/6e4),a=Math.floor(s/1440),l=Math.floor(s%1440/60);x.reset({id:t.id,title:t.title||"",start:e,durationDays:a,durationHours:l,durationMinutes:s%60,description:t.description||"",clientId:t.clientId||null,clientName:t.clientName||null,isPersonal:t.isPersonal||!1,attachVideoLink:!!t.videoCallLink})}else x.reset({id:void 0,title:"",start:new Date,durationDays:0,durationHours:1,durationMinutes:0,description:"",clientId:null,clientName:null,isPersonal:!1,attachVideoLink:!1})},[s,t,x]);let m=async e=>{u(!0);let s=new Date(e.start);s.setDate(s.getDate()+(e.durationDays||0)),s.setHours(s.getHours()+(e.durationHours||0)),s.setMinutes(s.getMinutes()+(e.durationMinutes||0));try{let l=d.find(s=>s.uid===e.clientId),t={...e,end:s,clientName:(null==l?void 0:l.fullName)||null,coachId:null==c?void 0:c.uid,coachName:null==c?void 0:c.displayName},n=await (0,aa.K)(t);if(n.success)i({title:"Success!",description:"Appointment has been ".concat(e.id?"updated":"created",".")}),a(!0);else throw Error(n.error||"An unknown error occurred.")}catch(e){i({variant:"destructive",title:"Error",description:e.message})}finally{u(!1)}},p=async()=>{if(null==t?void 0:t.id){u(!0);try{let e=await (0,al.A)(t.id);if(e.success)i({title:"Event Deleted"}),a(!0);else throw Error(e.error||"Failed to delete event.")}catch(e){i({variant:"destructive",title:"Error",description:e.message})}finally{u(!1)}}},v=d.map(e=>({value:e.uid,label:"".concat(e.fullName," (").concat(e.email,")")})),N=x.watch("isPersonal");return(0,l.jsx)(b.lG,{open:s,onOpenChange:()=>a(!1),children:(0,l.jsxs)(b.Cf,{className:"w-[90vw] max-w-lg h-[90vh] flex flex-col p-0",children:[(0,l.jsxs)(b.c7,{className:"p-6 pb-4",children:[(0,l.jsx)(b.L3,{children:(null==t?void 0:t.id)?"Edit Event":"Make Appointment"}),(null==t?void 0:t.id)?(0,l.jsx)(b.rr,{children:"Update the details for this event."}):(0,l.jsx)(b.rr,{children:"Create a new event on your calendar."})]}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(B.F,{className:"h-full",children:(0,l.jsx)("div",{className:"px-6 pb-6",children:(0,l.jsx)(eh.lV,{...x,children:(0,l.jsxs)("form",{onSubmit:x.handleSubmit(m),id:"event-form",className:"space-y-4",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"title",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Title"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{...s})}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-end gap-2",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"start",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex-1 flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Start Time"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(eu.p,{type:"date",value:(0,eP.GP)(s.value,"yyyy-MM-dd"),onChange:e=>{let a=new Date(e.target.value),l=6e4*a.getTimezoneOffset(),t=new Date(a.getTime()+l),n=new Date(s.value);n.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),s.onChange(n)}}),(0,l.jsx)(eu.p,{type:"time",value:(0,eP.GP)(s.value,"HH:mm"),onChange:e=>{let[a,l]=e.target.value.split(":").map(Number),t=new Date(s.value);t.setHours(a,l),s.onChange(t)}})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsxs)("div",{className:"flex items-end gap-1",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"durationDays",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Days"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{className:"w-16",type:"number",...s})})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"durationHours",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Hrs"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{className:"w-16",type:"number",...s})})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"durationMinutes",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{className:"text-xs",children:"Min"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{className:"w-16",type:"number",...s})})]})}})]})]}),(0,l.jsx)(eh.zB,{control:x.control,name:"isPersonal",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsx)(eh.lR,{children:"Personal Event"}),(0,l.jsx)(eh.Rr,{className:"text-xs",children:"Mark this if it's a personal appointment."})]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(at.d,{checked:s.value,onCheckedChange:s.onChange})})]})}}),!N&&(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(eh.zB,{control:x.control,name:"clientId",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Client (Optional)"}),(0,l.jsx)("div",{className:"w-full max-w-sm",children:(0,l.jsx)(su,{options:v,value:s.value||"",onChange:s.onChange,placeholder:"Select a client...",searchPlaceholder:"Search clients...",modal:!0})}),(0,l.jsx)(eh.Rr,{className:"text-xs",children:"Link this appointment to a specific client."}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:x.control,name:"attachVideoLink",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsxs)(eh.lR,{className:"flex items-center gap-2",children:[(0,l.jsx)(as.A,{className:"h-4 w-4"}),"Attach Default Video Link"]}),(0,l.jsx)(eh.Rr,{className:"text-xs",children:"Add your saved video call link to this event."})]}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(at.d,{checked:s.value,onCheckedChange:s.onChange})})]})}})]}),(0,l.jsx)(eh.zB,{control:x.control,name:"description",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Description / Notes"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(X.T,{...s})}),(0,l.jsx)(eh.C5,{})]})}})]})})})})}),(0,l.jsxs)(b.Es,{className:"p-6 pt-2 flex justify-between w-full border-t",children:[(0,l.jsx)("div",{children:(null==t?void 0:t.id)&&(0,l.jsxs)(n.$,{variant:"destructive",size:"sm",onClick:p,disabled:h,children:[(0,l.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Delete"]})}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{type:"submit",form:"event-form",disabled:h,children:[h&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),(null==t?void 0:t.id)?"Save Changes":"Create Event"]})]})]})]})})}var ai=a(33086),ac=a(45444),ad=a(7710);let ao=(0,v.createServerReference)("403550d6e5170ca86a3d2d54b9b31bdb78c40440e5",v.callServer,void 0,v.findSourceMapURL,"saveCoachAvailability");var ah=a(35027);let au=eo.Ik({weekly:eo.YO(eo.Ik({day:eo.Yj(),enabled:eo.zM(),slots:eo.YO(eo.Ik({start:eo.Yj().regex(/^([01]\d|2[0-3]):([0-5]\d)$/),end:eo.Yj().regex(/^([01]\d|2[0-3]):([0-5]\d)$/)}))})).length(7),vacationBlocks:eo.YO(eo.Ik({start:eo.p6(),end:eo.p6(),notes:eo.Yj().optional()})).optional()});function ax(e){let{open:s,onOpenChange:a}=e,{toast:t}=(0,f.dj)(),[i,c]=(0,r.useState)(!1),d=(0,ec.mN)({resolver:(0,ed.u)(au),defaultValues:{weekly:[{day:"Sunday",enabled:!1,slots:[]},{day:"Monday",enabled:!0,slots:[{start:"09:00",end:"17:00"}]},{day:"Tuesday",enabled:!0,slots:[{start:"09:00",end:"17:00"}]},{day:"Wednesday",enabled:!0,slots:[{start:"09:00",end:"17:00"}]},{day:"Thursday",enabled:!0,slots:[{start:"09:00",end:"17:00"}]},{day:"Friday",enabled:!0,slots:[{start:"09:00",end:"17:00"}]},{day:"Saturday",enabled:!1,slots:[]}],vacationBlocks:[]}}),{fields:o,append:h,remove:x}=(0,ec.jz)({control:d.control,name:"vacationBlocks"});(0,r.useEffect)(()=>{s&&(c(!0),(0,ah.v)().then(e=>{var s,a;e.success&&(null==(s=e.data)?void 0:s.availability)&&d.reset({...e.data.availability,vacationBlocks:(null==(a=e.data.availability.vacationBlocks)?void 0:a.map(e=>({...e,start:new Date(e.start),end:new Date(e.end)})))||[]}),c(!1)}))},[s,d]);let p=async e=>{c(!0);try{let s=await ao(e);if(s.success)t({title:"Availability Saved!",description:"Your schedule has been updated."}),a(!1);else throw Error(s.error)}catch(e){t({variant:"destructive",title:"Error",description:e.message})}finally{c(!1)}},v=(0,l.jsx)(eh.lV,{...d,children:(0,l.jsxs)("form",{onSubmit:d.handleSubmit(p),id:"availability-form",className:"space-y-6 p-1",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Weekly Schedule"}),(0,l.jsx)("div",{className:"space-y-3",children:d.getValues("weekly").map((e,s)=>(0,l.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(eh.lR,{children:e.day}),(0,l.jsx)(eh.zB,{control:d.control,name:"weekly.".concat(s,".enabled"),render:e=>{let{field:s}=e;return(0,l.jsx)(eh.eI,{children:(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(at.d,{checked:s.value,onCheckedChange:s.onChange})})})}})]}),d.watch("weekly.".concat(s,".enabled"))&&(0,l.jsxs)("div",{className:"space-y-2 mt-2 pt-2 border-t",children:[(d.watch("weekly.".concat(s,".slots"))||[]).map((e,a)=>(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(eh.zB,{control:d.control,name:"weekly.".concat(s,".slots.").concat(a,".start"),render:e=>{let{field:s}=e;return(0,l.jsx)(eh.eI,{className:"flex-1",children:(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"time",...s})})})}}),(0,l.jsx)("span",{children:"-"}),(0,l.jsx)(eh.zB,{control:d.control,name:"weekly.".concat(s,".slots.").concat(a,".end"),render:e=>{let{field:s}=e;return(0,l.jsx)(eh.eI,{className:"flex-1",children:(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{type:"time",...s})})})}}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>{let e=d.getValues("weekly.".concat(s,".slots"));d.setValue("weekly.".concat(s,".slots"),e.filter((e,s)=>s!==a))},children:(0,l.jsx)(w.A,{className:"h-4 w-4"})})]},a)),(0,l.jsxs)(n.$,{type:"button",size:"sm",variant:"outline",className:"w-full",onClick:()=>{let e=d.getValues("weekly.".concat(s,".slots"))||[];d.setValue("weekly.".concat(s,".slots"),[...e,{start:"09:00",end:"17:00"}])},children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Add Time Slot"]})]})]},e.day))})]}),(0,l.jsx)(D.w,{}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Vacations / Time Off"}),(0,l.jsxs)("div",{className:"space-y-2",children:[o.map((e,s)=>(0,l.jsxs)("div",{className:"p-3 border rounded-lg space-y-2",children:[(0,l.jsx)("div",{className:"flex justify-end",children:(0,l.jsx)(n.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>x(s),className:"h-7 w-7",children:(0,l.jsx)(w.A,{className:"h-4 w-4 text-destructive"})})}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(eh.zB,{control:d.control,name:"vacationBlocks.".concat(s,".start"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"Start Date"}),(0,l.jsxs)(eB.AM,{children:[(0,l.jsx)(eB.Wv,{asChild:!0,children:(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(n.$,{variant:"outline",className:"justify-start text-left font-normal",children:[(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4"}),s.value?(0,eP.GP)(s.value,"MM/dd/yy"):(0,l.jsx)("span",{children:"Pick a date"})]})})}),(0,l.jsx)(eB.hl,{className:"w-auto p-0",children:(0,l.jsx)(eF.V,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(eh.C5,{})]})}}),(0,l.jsx)(eh.zB,{control:d.control,name:"vacationBlocks.".concat(s,".end"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-col",children:[(0,l.jsx)(eh.lR,{children:"End Date"}),(0,l.jsxs)(eB.AM,{children:[(0,l.jsx)(eB.Wv,{asChild:!0,children:(0,l.jsx)(eh.MJ,{children:(0,l.jsxs)(n.$,{variant:"outline",className:"justify-start text-left font-normal",children:[(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4"}),s.value?(0,eP.GP)(s.value,"MM/dd/yy"):(0,l.jsx)("span",{children:"Pick a date"})]})})}),(0,l.jsx)(eB.hl,{className:"w-auto p-0",children:(0,l.jsx)(eF.V,{mode:"single",selected:s.value,onSelect:s.onChange,initialFocus:!0})})]}),(0,l.jsx)(eh.C5,{})]})}})]}),(0,l.jsx)(eh.zB,{control:d.control,name:"vacationBlocks.".concat(s,".notes"),render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{children:[(0,l.jsx)(eh.lR,{children:"Notes"}),(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(eu.p,{placeholder:"e.g., Holiday Break",...s})}),(0,l.jsx)(eh.C5,{})]})}})]},e.id)),(0,l.jsxs)(n.$,{type:"button",size:"sm",variant:"outline",className:"w-full",onClick:()=>h({start:new Date,end:new Date,notes:""}),children:[(0,l.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Add Vacation Block"]})]})]})]})});return(0,l.jsx)(e7,{open:s,onOpenChange:a,title:"Set Shared Availability",description:"Define the standard working hours and vacation days for all coaches.",footer:(0,l.jsxs)("div",{className:"flex justify-between w-full",children:[(0,l.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),(0,l.jsxs)(n.$,{type:"submit",form:"availability-form",disabled:i,children:[i&&(0,l.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Availability"]})]}),children:v})}function am(e){let{open:s,onOpenChange:a}=e,{toast:t}=(0,f.dj)(),[i,c]=(0,r.useState)("day"),[d,o]=(0,r.useState)(new Date),[h,u]=(0,r.useState)([]),[x,m]=(0,r.useState)(!1),[j,p]=(0,r.useState)(!1),[v,g]=(0,r.useState)(!1),[N,y]=(0,r.useState)(null),w=(0,r.useCallback)(async(e,s)=>{let a,l;m(!0),"month"===s?(a=(0,s3.w)(e),l=(0,s6.p)(e)):"week"===s?(a=(0,sK.k)(e),l=(0,sQ.$)(e)):(a=(0,sY.o)(e),l=(0,ai.D)(e));try{let e=await sL(a,l);if(e.success&&e.data)u(e.data);else throw Error(e.error||"Failed to fetch events")}catch(e){t({variant:"destructive",title:"Error",description:e.message})}finally{m(!1)}},[t]);(0,r.useEffect)(()=>{s&&w(d,i)},[s,d,i,w]);let C=e=>{y(e),p(!0)},S=e=>{o(e),c("day")};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.lG,{open:s,onOpenChange:a,children:(0,l.jsxs)(b.Cf,{className:"w-[90vw] max-w-7xl h-[90dvh] flex flex-col p-0",children:[(0,l.jsxs)(b.c7,{className:"p-2 border-b flex flex-row items-center justify-between",children:[(0,l.jsx)(b.L3,{srOnly:!0,children:"Coach Calendar"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(n.$,{onClick:()=>g(!0),size:"sm",variant:"outline",children:[(0,l.jsx)(ac.A,{className:"h-4 w-4 mr-2"}),"Set Availability"]}),(0,l.jsxs)(n.$,{onClick:()=>{y(null),p(!0)},size:"sm",children:[(0,l.jsx)(ad.A,{className:"h-4 w-4 mr-2"}),"Appointment"]})]})]}),(0,l.jsxs)(e2.tU,{value:i,onValueChange:e=>c(e),className:"flex-1 flex flex-col min-h-0",children:[(0,l.jsx)("div",{className:"px-2 py-1 border-b",children:(0,l.jsxs)(e2.j7,{className:"grid w-full grid-cols-3 max-w-xs mx-auto",children:[(0,l.jsx)(e2.Xi,{value:"day",children:"Day"}),(0,l.jsx)(e2.Xi,{value:"week",children:"Week"}),(0,l.jsx)(e2.Xi,{value:"month",children:"Month"})]})}),(0,l.jsxs)("div",{className:"flex-1 min-h-0",children:[(0,l.jsx)(e2.av,{value:"day",className:"h-full m-0",children:(0,l.jsx)(sX,{currentDate:d,setCurrentDate:o,events:h,isLoading:x,onEventClick:C,onDayClick:S})}),(0,l.jsx)(e2.av,{value:"week",className:"h-full m-0",children:(0,l.jsx)(s5,{currentDate:d,setCurrentDate:o,events:h,isLoading:x,onEventClick:C,onDayClick:S})}),(0,l.jsx)(e2.av,{value:"month",className:"h-full m-0",children:(0,l.jsx)(ae,{currentDate:d,setCurrentDate:o,events:h,isLoading:x,onEventClick:C,onDayClick:S})})]})]})]})}),(0,l.jsx)(ar,{isOpen:j,onClose:e=>{p(!1),y(null),e&&w(d,i)},event:N}),(0,l.jsx)(ax,{open:v,onOpenChange:g})]})}let aj=(0,v.createServerReference)("40aff455a6b87122d0661dbbc0697340a8eb5e3c8c",v.callServer,void 0,v.findSourceMapURL,"searchUSDA"),ap=(0,v.createServerReference)("40cc69142906798dd6f98c1577f8a14537cb8dff19",v.callServer,void 0,v.findSourceMapURL,"checkCachedStatus"),af=(0,v.createServerReference)("40451d6f8c2d98c1edf3c22eadf6fe85796e333a86",v.callServer,void 0,v.findSourceMapURL,"getEnrichedFood"),av=(0,v.createServerReference)("407157a68e12ff198ed382be4fce1d4fb430c02b46",v.callServer,void 0,v.findSourceMapURL,"getFoodDetails"),ag=(0,v.createServerReference)("40c898f888cbe9a311bb56b0ddfdd1df76df1c6cd6",v.callServer,void 0,v.findSourceMapURL,"saveManualEnrichedFood"),aN=(0,v.createServerReference)("4025c0bff91a2b32471f862435891f8cebfb78a123",v.callServer,void 0,v.findSourceMapURL,"deleteFoodFromCache");var ay=a(18720),ab=a(73457);let aw=eo.Ik({fdcId:eo.ai(),description:eo.Yj().min(1,"Description is required"),brandOwner:eo.Yj().optional(),ingredients:eo.Yj().optional(),source:eo.k5(["AI_ANALYSIS","USER_PROVIDED"]),analysisDate:eo.Yj(),upfAnalysis:eo.Ik({rating:eo.fc(i.SX),justification:eo.Yj()}),glutenAnalysis:eo.Ik({isGlutenFree:eo.zM(),justification:eo.Yj()}),upfPercentage:eo.Ik({value:eo.ai().min(0).max(100),justification:eo.Yj()}),portionSizes:eo.YO(eo.Ik({description:eo.Yj().min(1,"Description is required"),gramWeight:eo.ai().positive("Gram weight must be positive")})),nutrients:eo.YO(eo.Ik({id:eo.ai().optional(),name:eo.Yj(),amount:eo.ai(),unitName:eo.Yj()}))}),aC=e=>{let{isOpen:s,onClose:a,fdcId:t}=e,c=e=>e?e.map(e=>({...e,amount:Math.round(10*(e.amount||0))/10})):[],[d,o]=(0,r.useState)(!1),[h,u]=(0,r.useState)(null),x=(0,ec.mN)({resolver:(0,ed.u)(aw),defaultValues:{fdcId:0,description:"",brandOwner:"",ingredients:"",source:"USER_PROVIDED",analysisDate:new Date().toISOString(),upfAnalysis:{rating:i.SX.UNCLASSIFIED,justification:""},glutenAnalysis:{isGlutenFree:!1,justification:""},upfPercentage:{value:0,justification:""},portionSizes:[],nutrients:[]}}),{control:m,register:j,handleSubmit:p,reset:f}=x,v=(0,ec.FH)({control:m,name:"nutrients"})||[],{fields:g,append:N,remove:y}=(0,ec.jz)({control:m,name:"portionSizes"}),w=(0,r.useCallback)(async e=>{o(!0),u(null);try{let d=await af(e);if(d){var s,a,l,t,n,r;let e={...d,upfAnalysis:{rating:(null==(s=d.upfAnalysis)?void 0:s.rating)||i.SX.UNCLASSIFIED,justification:(null==(a=d.upfAnalysis)?void 0:a.justification)||""},glutenAnalysis:{isGlutenFree:(null==(l=d.glutenAnalysis)?void 0:l.isGlutenFree)||!1,justification:(null==(t=d.glutenAnalysis)?void 0:t.justification)||""},upfPercentage:{value:(null==(n=d.upfPercentage)?void 0:n.value)||0,justification:(null==(r=d.upfPercentage)?void 0:r.justification)||""},brandOwner:d.brandOwner||"",ingredients:d.ingredients||"",nutrients:c(d.nutrients),portionSizes:d.portionSizes||[]};f(e)}else{let s=await av(e);s&&f({fdcId:e,description:s.description,brandOwner:"",ingredients:s.ingredients||"",nutrients:c(s.nutrients),source:"USER_PROVIDED",analysisDate:new Date().toISOString(),upfAnalysis:{rating:i.SX.UNCLASSIFIED,justification:"Awaiting manual analysis."},glutenAnalysis:{isGlutenFree:!1,justification:""},upfPercentage:{value:0,justification:""},portionSizes:[{description:"100g",gramWeight:100}]})}}catch(e){u("Failed to load food data.")}finally{o(!1)}},[f]);(0,r.useEffect)(()=>{s&&t?w(t):s||(f(),u(null))},[s,t,w,f]);let C=async e=>{o(!0),u(null);try{let s=await ag(e);s.success?(ay.oR.success("Food item saved successfully!"),a({fdcId:e.fdcId})):u(s.error||"Save failed. Please check the fields.")}catch(e){u("A server error occurred. Please try again.")}finally{o(!1)}},S=async()=>{if(t&&window.confirm("Are you sure you want to permanently delete this item from the cache?")){o(!0),u(null);try{let e=await aN(t);e.success?(ay.oR.success("Food item deleted successfully!"),a({fdcId:t})):u(e.error||"Deletion failed. Please try again.")}catch(e){u("A server error occurred during deletion. Please try again.")}finally{o(!1)}}},A=(e,s,a)=>{let t=v.findIndex(s=>s.name.toLowerCase()===e.toLowerCase());return -1===t?null:(0,l.jsxs)("div",{className:"space-y-2 text-center",children:[(0,l.jsx)(eE.J,{htmlFor:"nutrient-".concat(t),children:s}),(0,l.jsxs)("div",{className:"flex items-center justify-center",children:[(0,l.jsx)(eu.p,{id:"nutrient-".concat(t),type:"number",step:"Calories"===s?"1":"0.1",className:"text-center p-1 h-9",...j("nutrients.".concat(t,".amount"),{valueAsNumber:!0})}),(0,l.jsx)("span",{className:"ml-1 text-xs text-muted-foreground",children:a})]})]})};return(0,l.jsx)(b.lG,{open:s,onOpenChange:e=>!e&&a(null),children:(0,l.jsxs)(b.Cf,{className:"max-w-4xl max-h-[90vh] flex flex-col",children:[(0,l.jsxs)(b.c7,{children:[(0,l.jsx)(b.L3,{children:"Food Cache Management"}),(0,l.jsx)(b.rr,{children:"View, edit, and analyze all nutritional information for this food item."})]}),d&&(0,l.jsx)("p",{className:"text-center py-12",children:"Loading..."}),h&&(0,l.jsx)("p",{className:"text-destructive p-3 rounded-md my-4 text-sm text-center",children:h}),!d&&t&&(0,l.jsx)(eh.lV,{...x,children:(0,l.jsxs)("form",{onSubmit:p(C,e=>{console.error("Form validation failed:",e),u("Form is invalid. See console for details.")}),className:"flex-1 flex flex-col overflow-hidden gap-4",children:[(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto pr-4 space-y-4",children:[(0,l.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2 col-span-1",children:[(0,l.jsx)(eE.J,{htmlFor:"fdcId",children:"FDC ID"}),(0,l.jsx)(eu.p,{id:"fdcId",...j("fdcId",{valueAsNumber:!0}),readOnly:!0})]}),(0,l.jsxs)("div",{className:"space-y-2 col-span-2",children:[(0,l.jsx)(eE.J,{htmlFor:"description",children:"Description"}),(0,l.jsx)(eu.p,{id:"description",...j("description")})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"brandOwner",children:"Brand Owner"}),(0,l.jsx)(eu.p,{id:"brandOwner",...j("brandOwner")})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"ingredients",children:"Ingredients"}),(0,l.jsx)(X.T,{id:"ingredients",...j("ingredients"),rows:3})]}),(0,l.jsxs)("div",{className:"p-4 border rounded-md",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"Nutritional Information (per 100g)"}),v.length>0?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-3 mb-4",children:[A("Energy","Calories","kcal"),A("Protein","Protein","g"),A("Total lipid (fat)","Fat","g"),A("Carbohydrate, by difference","Carbs","g"),A("Fiber, total dietary","Fiber","g")]}),(0,l.jsxs)("details",{children:[(0,l.jsx)("summary",{className:"cursor-pointer text-sm",children:"Toggle Full Nutrition Details"}),(0,l.jsx)("div",{className:"mt-2 p-2 bg-muted/50 rounded-md max-h-32 overflow-y-auto text-xs",children:v.map(e=>(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:e.name}),(0,l.jsxs)("span",{children:[(e.amount||0).toFixed(1),e.unitName]})]},e.id||e.name))})]})]}):(0,l.jsx)("div",{className:"text-center py-4 text-muted-foreground",children:"Loading nutritional data..."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"p-4 border rounded-md space-y-3",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"UPF Analysis"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"upfPercentage",children:"UPF Percentage"}),(0,l.jsx)(eu.p,{id:"upfPercentage",type:"number",...j("upfPercentage.value",{valueAsNumber:!0})})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{children:"NOVA Group"}),(0,l.jsx)(eh.zB,{control:m,name:"upfAnalysis.rating",render:e=>{let{field:s}=e;return(0,l.jsxs)(el.l6,{onValueChange:s.onChange,value:s.value,children:[(0,l.jsx)(el.bq,{children:(0,l.jsx)(el.yv,{})}),(0,l.jsx)(el.gC,{children:Object.values(i.SX).map(e=>(0,l.jsx)(el.eb,{value:e,children:e},e))})]})}})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"upfJustification",children:"Justification"}),(0,l.jsx)(X.T,{id:"upfJustification",...j("upfAnalysis.justification"),rows:2})]})]}),(0,l.jsxs)("div",{className:"p-4 border rounded-md space-y-3",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Gluten Analysis"}),(0,l.jsx)(eh.zB,{control:m,name:"glutenAnalysis.isGlutenFree",render:e=>{let{field:s}=e;return(0,l.jsxs)(eh.eI,{className:"flex flex-row items-center space-x-2 pt-2",children:[(0,l.jsx)(eh.MJ,{children:(0,l.jsx)(ab.S,{checked:s.value,onCheckedChange:s.onChange,id:"glutenValue"})}),(0,l.jsx)(eE.J,{htmlFor:"glutenValue",className:"!mt-0 font-normal",children:"Gluten Free"})]})}}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(eE.J,{htmlFor:"glutenJustification",children:"Justification"}),(0,l.jsx)(X.T,{id:"glutenJustification",...j("glutenAnalysis.justification"),rows:4})]})]})]}),(0,l.jsxs)("div",{className:"p-4 border rounded-md",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Portion Sizes"}),(0,l.jsx)("div",{className:"space-y-3 max-h-40 overflow-y-auto pr-2",children:g.map((e,s)=>(0,l.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,l.jsx)(eu.p,{...j("portionSizes.".concat(s,".description")),placeholder:"e.g., 1 cup",className:"col-span-7"}),(0,l.jsx)(eu.p,{type:"number",...j("portionSizes.".concat(s,".gramWeight"),{valueAsNumber:!0}),placeholder:"Grams",className:"col-span-3"}),(0,l.jsx)(n.$,{type:"button",variant:"destructive",onClick:()=>y(s),className:"col-span-2",children:"X"})]},e.id))}),(0,l.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:()=>N({description:"",gramWeight:0}),className:"mt-3",children:" + Add Portion"})]})]}),(0,l.jsxs)(b.Es,{className:"pt-4 border-t",children:[(0,l.jsx)(n.$,{type:"button",variant:"ghost",onClick:()=>a(null),className:"mr-auto",children:"Cancel"}),(0,l.jsx)(n.$,{type:"button",variant:"destructive",disabled:d,onClick:S,children:"Delete"}),(0,l.jsx)(n.$,{type:"submit",disabled:d,children:d?"Saving...":"Save"})]})]})})]})})};function aS(e){let{open:s,onOpenChange:a}=e,[t,i]=(0,r.useState)(""),[c,d]=(0,r.useState)([]),[o,h]=(0,r.useState)(!1),[u,x]=(0,r.useState)(null),[m,j]=(0,r.useState)(new Set),[p,f]=(0,r.useState)(!1),[v,g]=(0,r.useState)(null),N=(0,r.useCallback)(async()=>{if(t.length<3)return void d([]);h(!0),x(null);try{let e=(await aj(t)).filter(e=>null!=e&&"number"==typeof e.fdcId&&"string"==typeof e.description);if(d(e),e.length>0){let s=e.map(e=>e.fdcId),a=await ap(s);j(new Set(a))}else j(new Set)}catch(e){x("Failed to search for food items."),console.error(e)}finally{h(!1)}},[t]);return(0,r.useEffect)(()=>{let e=setTimeout(()=>{s&&N()},500);return()=>clearTimeout(e)},[t,s,N]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(b.lG,{open:s,onOpenChange:a,children:(0,l.jsxs)(b.Cf,{className:"max-w-3xl",children:[(0,l.jsx)(b.c7,{children:(0,l.jsx)(b.L3,{children:"Manage Food Cache"})}),(0,l.jsx)("div",{className:"py-4",children:(0,l.jsx)(eu.p,{type:"text",value:t,onChange:e=>i(e.target.value),placeholder:"Search for a food item in USDA database..."})}),o&&(0,l.jsx)("p",{className:"text-center py-4",children:"Searching..."}),u&&(0,l.jsx)("p",{className:"text-destructive text-center py-4",children:u}),(0,l.jsx)("div",{className:"space-y-2 max-h-[50vh] overflow-y-auto p-1",children:c.map(e=>(0,l.jsxs)("div",{className:"p-3 border rounded-lg flex justify-between items-center",children:[(0,l.jsxs)("div",{className:"max-w-prose",children:[(0,l.jsx)("p",{className:"font-semibold",children:e.description}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:e.brandOwner})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4 flex-shrink-0 ml-4",children:[m.has(e.fdcId)&&(0,l.jsx)("span",{className:"text-sm font-semibold text-green-500",children:"Cached"}),(0,l.jsx)(n.$,{variant:m.has(e.fdcId)?"secondary":"default",onClick:()=>{g(e.fdcId),f(!0)},children:m.has(e.fdcId)?"Edit":"Add"})]})]},e.fdcId))}),(0,l.jsx)(b.Es,{children:(0,l.jsx)(n.$,{variant:"outline",onClick:()=>a(!1),children:"Close"})})]})}),p&&(0,l.jsx)(aC,{isOpen:p,onClose:e=>{f(!1),g(null),e&&("description"in e?(d(s=>s.map(s=>s.fdcId===e.fdcId?{...s,description:e.description,brandOwner:e.brandOwner}:s)),j(s=>new Set(s).add(e.fdcId))):(d(s=>s.filter(s=>s.fdcId!==e.fdcId)),j(s=>{let a=new Set(s);return a.delete(e.fdcId),a})))},fdcId:v})]})}let aA=e=>{if(!e)return null;let s=Object.keys(e).sort((e,s)=>s.localeCompare(e));return s.length>0?e[s[0]]:null};function ak(e){let{initialClients:s}=e,{toast:a}=(0,f.dj)(),[v,b]=(0,r.useState)(s),[w,C]=(0,r.useState)(!1),[S,A]=(0,r.useState)(null),[k,M]=(0,r.useState)(""),[I,R]=(0,r.useState)("all"),[D,z]=(0,r.useState)("at-risk"),[T,P]=(0,r.useState)(!1),[E,B]=(0,r.useState)(!1),[F,L]=(0,r.useState)(!1),[V,$]=(0,r.useState)(!1),[J,O]=(0,r.useState)(!1),[Y,G]=(0,r.useState)(!1),[H,_]=(0,r.useState)(!1),[q,W]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(null),[K,Q]=(0,r.useState)(!1),ee=(0,r.useCallback)(async()=>{C(!0);try{let e=await g();e.success&&e.data?b(e.data):a({variant:"destructive",title:"Error",description:"Could not refresh clients list."})}catch(e){a({variant:"destructive",title:"Error",description:e.message})}finally{C(!1)}},[a]);(0,r.useEffect)(()=>{},[ee]);let es=async e=>{if("coaching"!==e.tier)return void a({variant:"destructive",title:"Not a Coaching Client",description:"Only clients on the coaching tier have private chats."});Q(!0);let s=await U(e.uid);s.success&&s.chatId?(Z({id:s.chatId,name:"".concat(e.fullName," Coaching")}),W(!0)):a({variant:"destructive",title:"Error",description:"Could not find the coaching chat for this client."}),Q(!1)},ea=(0,r.useMemo)(()=>{let e=v;if(k)e=v.filter(e=>e.fullName.toLowerCase().includes(k.toLowerCase())||e.email.toLowerCase().includes(k.toLowerCase()));else if("all"!==I&&(e=e.filter(e=>e.tier===I)),"at-risk"===D){let s=[];e.forEach(e=>{var a,l,t;let n=aA(e.dailySummaries);if(!n)return;let r="",i=0;(null!=(a=n.binges)?a:0)>0?(r="Recent Binge",i=3):(null!=(l=n.cravings)?l:0)>1?(r="Multiple Cravings",i=2):(null!=(t=n.stressEvents)?t:0)>1&&(r="Multiple Stress Events",i=1),r&&s.push({...e,reason:r,atRiskScore:i})}),s.sort((e,s)=>s.atRiskScore-e.atRiskScore),e=s}return"at-risk"!==D&&e.sort((e,s)=>{let a=aA(e.dailySummaries),l=aA(s.dailySummaries),t=(null==a?void 0:a.lastUpdated)?new Date(a.lastUpdated).getTime():0;return((null==l?void 0:l.lastUpdated)?new Date(l.lastUpdated).getTime():0)-t}),e},[v,I,D,k]),et=e=>{var s;let{client:a}=e;return(0,l.jsxs)("div",{className:"w-full text-left p-1.5 pr-3 rounded-md border bg-card hover:bg-muted transition-colors flex items-center gap-2 text-sm",children:[(0,l.jsxs)("div",{className:"flex-1 flex items-center gap-2 min-w-0 cursor-pointer",onClick:()=>A(a),children:[(0,l.jsxs)(N.eu,{className:"h-6 w-6 border",children:[(0,l.jsx)(N.BK,{src:a.photoURL||"https://placehold.co/100x100.png",alt:a.fullName,"data-ai-hint":"person portrait"}),(0,l.jsx)(N.q5,{className:"text-xs",children:null==(s=a.fullName)?void 0:s.charAt(0).toUpperCase()})]}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 flex items-center gap-2",children:[(0,l.jsx)("span",{className:"font-semibold truncate text-xs",children:a.fullName}),a.reason&&(0,l.jsx)(y.E,{variant:"Recent Binge"===a.reason?"destructive":"secondary",className:"flex-shrink-0",children:a.reason})]})]}),(0,l.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>es(a),disabled:K,children:(0,l.jsx)(c.A,{className:"h-3.5 w-3.5"})})]})},er=[{label:"Chats",icon:c.A,action:()=>O(!0)},{label:"Challenges",icon:d.A,action:()=>B(!0)},{label:"Pop-ups",icon:o.A,action:()=>L(!0)},{label:"Library",icon:h.A,action:()=>$(!0)},{label:"Calendar",icon:u.A,action:()=>G(!0)},{label:"Food Cache",icon:x.A,action:()=>_(!0)}];return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-4",children:[(0,l.jsx)("div",{className:"grid grid-cols-6 gap-2 md:hidden",children:er.map(e=>{let{label:s,icon:a,action:t}=e;return(0,l.jsx)(n.$,{variant:"outline",className:"flex flex-col h-16 items-center justify-center",onClick:t,children:(0,l.jsx)(a,{className:"h-7 w-7"})},s)})}),(0,l.jsxs)("div",{className:"hidden md:flex md:flex-wrap gap-2 justify-between",children:[(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>O(!0),children:[(0,l.jsx)(c.A,{})," Chats"]}),(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>B(!0),children:[(0,l.jsx)(d.A,{})," Challenges"]}),(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>L(!0),children:[(0,l.jsx)(o.A,{})," Pop-ups"]}),(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>$(!0),children:[(0,l.jsx)(h.A,{})," Library"]}),(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>G(!0),children:[(0,l.jsx)(u.A,{})," Calendar"]}),(0,l.jsxs)(n.$,{variant:"outline",onClick:()=>_(!0),children:[(0,l.jsx)(x.A,{})," Food Cache"]})]}),(0,l.jsx)(t.Zp,{children:(0,l.jsxs)(t.Wu,{className:"p-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,l.jsx)(eu.p,{placeholder:"Search clients...",value:k,onChange:e=>M(e.target.value),className:"flex-1"}),(0,l.jsxs)(el.l6,{value:I,onValueChange:R,children:[(0,l.jsx)(el.bq,{className:"flex-1",children:(0,l.jsx)(el.yv,{placeholder:"Filter by tier"})}),(0,l.jsxs)(el.gC,{children:[(0,l.jsx)(el.eb,{value:"all",children:"All Tiers"}),i.qc.map(e=>(0,l.jsx)(el.eb,{value:e,className:"capitalize",children:e},e))]})]}),(0,l.jsx)(n.$,{variant:"outline",size:"icon",className:"bg-yellow-400 text-black hover:bg-yellow-500 flex-shrink-0",onClick:()=>P(!0),children:(0,l.jsx)(m.A,{className:"h-5 w-5"})})]}),(0,l.jsx)(e2.tU,{defaultValue:"at-risk",onValueChange:z,className:"w-full mb-2",children:(0,l.jsxs)(e2.j7,{className:"grid w-full grid-cols-2",children:[(0,l.jsx)(e2.Xi,{value:"at-risk",children:"At-Risk Feed"}),(0,l.jsx)(e2.Xi,{value:"all",children:"All Clients"})]})}),w?(0,l.jsx)("div",{className:"flex items-center justify-center p-24",children:(0,l.jsx)(j.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-muted-foreground px-1",children:k?"Search Results (".concat(ea.length,")"):"at-risk"===D?"At-Risk Client Feed (".concat(ea.length,")"):"All Clients (".concat(ea.length,")")}),ea.length>0?ea.map(e=>(0,l.jsx)(et,{client:e},e.uid)):(0,l.jsxs)("div",{className:"text-center text-muted-foreground p-8",children:[(0,l.jsx)(p.A,{className:"h-10 w-10 mx-auto text-green-500 mb-2"}),(0,l.jsx)("p",{className:"font-semibold",children:"All Quiet!"}),(0,l.jsx)("p",{children:"No clients match your current filters."})]})]})]})})]}),S&&(0,l.jsx)(ei,{client:S,isOpen:!!S,onClose:()=>{A(null),ee()}}),X&&(0,l.jsx)(en.R,{isOpen:q,onClose:()=>W(!1),chatId:X.id,chatName:X.name}),(0,l.jsx)(eA,{open:T,onOpenChange:P,onClientCreated:()=>{P(!1),ee()}}),(0,l.jsx)(sU,{open:J,onOpenChange:O}),(0,l.jsx)(se,{open:E,onOpenChange:B}),(0,l.jsx)(sf,{open:F,onOpenChange:L}),(0,l.jsx)(sI,{open:V,onOpenChange:$}),(0,l.jsx)(am,{open:Y,onOpenChange:G}),(0,l.jsx)(aS,{open:H,onOpenChange:_})]})}}},e=>{e.O(0,[2992,7138,781,5612,5352,9118,8038,4972,6238,537,7075,6743,6201,3659,9203,7071,7473,7961,9984,8441,1255,7358],()=>e(e.s=64671)),_N_E=e.O()}]);