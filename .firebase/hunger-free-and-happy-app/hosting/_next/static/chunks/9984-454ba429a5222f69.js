"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9984],{6259:(e,t,a)=>{a.d(t,{SQ:()=>m,_2:()=>f,mB:()=>p,rI:()=>o,ty:()=>u});var s=a(95155),r=a(12115),l=a(37738),n=a(63263),i=a(72251),d=a(75797),c=a(64269);let o=l.bL,u=l.l9;l.YJ,l.ZL,l.Pb,l.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:i,...d}=e;return(0,s.jsxs)(l.ZP,{ref:t,className:(0,c.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...d,children:[i,(0,s.jsx)(n.A,{className:"ml-auto"})]})}).displayName=l.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.G5,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=l.G5.displayName;let m=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...n}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:t,sideOffset:r,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...n})})});m.displayName=l.UC.displayName;let f=r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.q7,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r&&"pl-8",a),...n})});f.displayName=l.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:n,...d}=e;return(0,s.jsxs)(l.H_,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:n,...d,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=l.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsxs)(l.hN,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...n,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(l.VF,{children:(0,s.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=l.hN.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...n}=e;return(0,s.jsx)(l.JU,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pl-8",a),...n})}).displayName=l.JU.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});p.displayName=l.wv.displayName},25583:(e,t,a)=>{a.d(t,{R:()=>E});var s=a(95155),r=a(51834),l=a(12115),n=a(82224),i=a(3998),d=a(65142),c=a(92033),o=a(13630),u=a(5225),m=a(28068),f=a(15567),p=a(94979),h=a(30926);let x=(0,h.createServerReference)("40950f8ced44f03ea49a1f4b3c8bf7401e56cad74c",h.callServer,void 0,h.findSourceMapURL,"getChatMessagesAction"),v=(0,h.createServerReference)("70715d809767b2bf4f4bcc23ed1ccfe34b78a8cd0f",h.callServer,void 0,h.findSourceMapURL,"getSignedUrlAction"),g=(0,h.createServerReference)("40581e7ba9bbf4c24217d62e5b83034289b767b808",h.callServer,void 0,h.findSourceMapURL,"postMessageAction"),b=(0,h.createServerReference)("4016537cd7788af3eee263e5e06dff244888358338",h.callServer,void 0,h.findSourceMapURL,"deleteMessageAction");var N=a(5282),j=a(64269),y=a(85897),w=a(15894),S=a(15239),R=a(52619),k=a.n(R),C=a(98053),U=a(19708),A=a(14585),L=a(17037);function M(e){let{text:t}=e;if(!t)return null;let a=/(https?:\/\/[^\s]+)/g,r=t.split(a);return(0,s.jsx)(s.Fragment,{children:r.map((e,t)=>a.test(e)?(0,s.jsx)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 underline hover:text-blue-300",children:e},t):e)})}function _(e){let{chatId:t}=e,{user:a,isCoach:r}=(0,n.A)(),{toast:h}=(0,w.dj)(),[R,_]=(0,l.useState)([]),[z,I]=(0,l.useState)({}),[E,F]=(0,l.useState)(!0),[T,D]=(0,l.useState)(!1),[O,P]=(0,l.useState)(""),$=(0,l.useRef)(null),[H,Z]=(0,l.useState)(null),[q,G]=(0,l.useState)(null),[J,B]=(0,l.useState)({open:!1,message:null}),[K,Q]=(0,l.useState)(!1),V=(0,l.useRef)(null),W=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";V.current&&V.current.scrollTo({top:V.current.scrollHeight,behavior:e})};(0,l.useEffect)(()=>{if(E)return;W("auto");let e=new MutationObserver(()=>{W("smooth")});return V.current&&e.observe(V.current,{childList:!0,subtree:!0}),()=>e.disconnect()},[R,E]),(0,l.useEffect)(()=>{if(!t){F(!1),_([]),I({});return}F(!0);let e=(0,U.P)((0,U.rJ)(A.db,"chats/".concat(t,"/messages")),(0,U.My)("timestamp","asc")),a=(0,U.aQ)(e,async e=>{if(_(e.docs.map(e=>{var t;return{id:e.id,...e.data(),timestamp:null==(t=e.data().timestamp)?void 0:t.toDate().toISOString()}})),0===Object.keys(z).length){var a;let e=await x(t);e.success&&(null==(a=e.data)?void 0:a.participants)&&I(e.data.participants)}F(!1)},e=>{console.error("Error fetching real-time messages:",e),h({variant:"destructive",title:"Error",description:"Could not load messages in real-time."}),F(!1)});return()=>a()},[t,h]);let Y=()=>{Z(null),G(null),$.current&&($.current.value="")},X=async e=>{if((e.preventDefault(),O.trim()||H)&&a&&t){D(!0);try{let e,s;if(H){let a=await v(H.name,"chats/".concat(t),H.type);if(!a.success||!a.signedUrl||!a.publicUrl)throw Error(a.error||"Could not get an upload URL.");if(!(await fetch(a.signedUrl,{method:"PUT",body:H,headers:{"Content-Type":H.type}})).ok)throw Error("File upload failed.");e=a.publicUrl,s=H.name}await g({chatId:t,text:O,userId:a.uid,userName:a.displayName||"Anonymous",isCoach:r||!1,fileUrl:e,fileName:s}),P(""),Y()}catch(e){h({variant:"destructive",title:"Error",description:e.message||"An unexpected error occurred."})}finally{D(!1)}}},ee=async()=>{if(!J.message||!a||!t)return;Q(!0);let{message:e}=J,s=await b({chatId:t,messageId:e.id,requesterId:a.uid});if(s.success)h({title:"Message Deleted"});else{var r;h({variant:"destructive",title:"Error",description:(null==(r=s.error)?void 0:r.message)||"Failed to delete message."})}Q(!1),B({open:!1,message:null})};return E?(0,s.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,s.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,s.jsxs)("div",{className:"flex flex-col h-full bg-background",children:[(0,s.jsx)(L.F,{className:"flex-1 min-h-0",viewportRef:V,children:(0,s.jsx)("div",{className:"space-y-1 p-4",children:R.map(e=>{var t;let l=r||e.userId===(null==a?void 0:a.uid),n=z[e.userId];return(0,s.jsx)("div",{className:(0,j.cn)("group flex min-w-0 items-end gap-2",e.isSystemMessage&&"flex-col items-center justify-center my-2",e.userId===(null==a?void 0:a.uid)?"justify-end":"justify-start"),children:e.isSystemMessage?(0,s.jsx)("div",{className:"text-xs text-center bg-muted text-muted-foreground rounded-full px-3 py-1 animate-in fade-in flex-wrap",children:e.text}):(0,s.jsxs)(s.Fragment,{children:[e.userId!==(null==a?void 0:a.uid)&&(0,s.jsxs)(y.eu,{className:"h-6 w-6 border flex-shrink-0",children:[(0,s.jsx)(y.BK,{src:(null==n?void 0:n.photoURL)||"",alt:e.userName}),(0,s.jsx)(y.q5,{className:"text-xs",children:(e=>{if(!e)return"?";let t=e.split(" ");return t.length>1?"".concat(t[0][0]).concat(t[t.length-1][0]).toUpperCase():e.charAt(0).toUpperCase()})(e.userName)})]}),l&&e.userId===(null==a?void 0:a.uid)&&(0,s.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground flex-shrink-0",onClick:()=>B({open:!0,message:e}),children:(0,s.jsx)(o.A,{className:"h-3 w-3"})}),(0,s.jsxs)("div",{className:(0,j.cn)("max-w-[80%] rounded-lg px-2 py-1 min-w-0",e.userId===(null==a?void 0:a.uid)?"bg-primary text-primary-foreground":"bg-muted"),children:[(0,s.jsx)("div",{className:"text-xs break-words",children:(0,s.jsx)(M,{text:e.text||""})}),e.fileUrl&&(0,s.jsx)("div",{className:"mt-1",children:(null==(t=e.fileName)?void 0:t.endsWith(".pdf"))?(0,s.jsxs)(k(),{href:e.fileUrl,target:"_blank",className:"flex items-center gap-2 p-1 rounded-md bg-background/20 hover:bg-background/40",children:[(0,s.jsx)(u.A,{className:"h-3 w-3"}),(0,s.jsx)("span",{className:"text-xs font-medium truncate max-w-[120px]",children:e.fileName||"Shared File"})]}):(0,s.jsx)(k(),{href:e.fileUrl,target:"_blank",children:(0,s.jsx)(S.default,{src:e.fileUrl,alt:e.fileName||"Shared Image",width:100,height:100,className:"rounded-md object-cover"})})}),(0,s.jsxs)("p",{className:(0,j.cn)("text-[10px] mt-0.5 opacity-70",e.userId===(null==a?void 0:a.uid)?"text-right":"text-left"),children:[e.userName.split(" ")[0]," - ",e.timestamp?(0,N.GP)(new Date(e.timestamp),"p"):""]})]}),l&&e.userId!==(null==a?void 0:a.uid)&&(0,s.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground flex-shrink-0",onClick:()=>B({open:!0,message:e}),children:(0,s.jsx)(o.A,{className:"h-3 w-3"})})]})},e.id)})})}),(0,s.jsxs)("div",{className:"flex-shrink-0 bg-background border-t p-2",children:[H&&(0,s.jsxs)("div",{className:"flex items-center gap-2 p-1.5 mb-1 rounded-md bg-muted border animate-in fade-in-50",children:[q&&(0,s.jsx)(S.default,{src:q,alt:"preview",width:24,height:24,className:"rounded-md object-cover"}),!q&&(0,s.jsx)(u.A,{className:"h-6 w-6 text-muted-foreground"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground flex-1 truncate",children:H.name}),(0,s.jsx)(i.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:Y,children:(0,s.jsx)(m.A,{className:"h-4 w-4"})})]}),(0,s.jsxs)("form",{onSubmit:X,className:"flex w-full items-center space-x-1",children:[(0,s.jsx)("input",{type:"file",ref:$,onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){if(a.size>5242880)return void h({variant:"destructive",title:"File Too Large",description:"Please select a file smaller than 5MB."});if(Z(a),a.type.startsWith("image/")){let e=new FileReader;e.onloadend=()=>G(e.result),e.readAsDataURL(a)}else G(null)}},className:"hidden",accept:"image/*,application/pdf"}),(0,s.jsx)(i.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var e;return null==(e=$.current)?void 0:e.click()},disabled:T,children:(0,s.jsx)(f.A,{className:"h-4 w-4"})}),(0,s.jsx)(d.p,{value:O,onChange:e=>P(e.target.value),placeholder:"Type a message...",disabled:T,className:"h-8 text-xs"}),(0,s.jsx)(i.$,{type:"submit",size:"icon",className:"h-8 w-8",disabled:T||!O.trim()&&!H,children:T?(0,s.jsx)(c.A,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,s.jsx)(C.Lt,{open:J.open,onOpenChange:e=>!e&&B({open:!1,message:null}),children:(0,s.jsxs)(C.EO,{children:[(0,s.jsxs)(C.wd,{children:[(0,s.jsx)(C.r7,{children:"Delete this message?"}),(0,s.jsx)(C.$v,{children:"This action cannot be undone. The message will be permanently removed from the chat."})]}),(0,s.jsxs)(C.ck,{children:[(0,s.jsx)(C.Zr,{children:"Cancel"}),(0,s.jsxs)(C.Rx,{onClick:ee,disabled:K,className:"bg-destructive hover:bg-destructive/90",children:[K&&(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete"]})]})]})})]})}let z=(0,h.createServerReference)("60be8f304944e4b740d86d0e26ac0f0f0df3a44674",h.callServer,void 0,h.findSourceMapURL,"markChatAsRead");var I=a(89836);function E(e){let{chatId:t,chatName:a,isOpen:i,onClose:d}=e,{user:c,isCoach:o}=(0,n.A)(),{fetchChats:u}=(0,I.TN)();return(0,l.useEffect)(()=>{i&&c&&!o&&t&&z(c.uid,t).then(()=>{u&&u()})},[i,c,o,t,u]),(0,s.jsx)(r.lG,{open:i,onOpenChange:d,children:(0,s.jsxs)(r.Cf,{className:"w-[90vw] max-w-xl h-[80vh] flex flex-col p-0 gap-0",children:[(0,s.jsxs)(r.c7,{className:"p-4 border-b text-center flex-shrink-0",children:[(0,s.jsx)(r.L3,{children:a}),(0,s.jsx)(r.HM,{})]}),(0,s.jsx)("div",{className:"flex-1 min-h-0",children:(0,s.jsx)(_,{chatId:t})})]})})}},55879:(e,t,a)=>{a.d(t,{K:()=>r});var s=a(30926);let r=(0,s.createServerReference)("4036d96a164a2a2bd23f4b0487b9b8a9adc6ce9181",s.callServer,void 0,s.findSourceMapURL,"saveCalendarEvent")},73457:(e,t,a)=>{a.d(t,{S:()=>d});var s=a(95155),r=a(12115),l=a(38162),n=a(72251),i=a(64269);let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(l.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,s.jsx)(l.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(n.A,{className:"h-4 w-4"})})})});d.displayName=l.bL.displayName},81962:(e,t,a)=>{a.d(t,{l:()=>r});var s=a(30926);let r=(0,s.createServerReference)("002c76e144978cb92b12d6d5ad6aa010cf1fb2f0a5",s.callServer,void 0,s.findSourceMapURL,"getCustomHabitsAction")},98173:(e,t,a)=>{a.d(t,{m:()=>r});var s=a(30926);let r=(0,s.createServerReference)("008852c59a481781e09ddb9fd14c2171b743479648",s.callServer,void 0,s.findSourceMapURL,"getChallengesForCoach")}}]);